
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>
            LiTScript - Bundler
        </title>
        <link rel="icon" type="image/icon" href="../images/favicon.png" />
        <link rel="stylesheet" href="../dist/normal.css" />
        
    </head>
    <body data-syntax-highlight="son-of-obsidian">
        
        <div id="navbar">
            
    <div class="navmenu ">
        
    <div class="navitem " >
        <a class="title enabled" href="../index.html" >
            <img src="../images/bulb.svg" />
            <span>LiTScript</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://www.npmjs.com/package/litscript" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-npm" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M1 8h22v7h-12v2h-4v-2h-6z" />
            <path d="M7 8v7" />
            <path d="M14 8v7" />
            <path d="M17 11v4" />
            <path d="M4 11v4" />
            <path d="M11 11v1" />
            <path d="M20 11v4" />
        </svg>
            <span>Download</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://github.com/johtela/litscript" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
        </svg>
            <span>GitHub</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="../license.html" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-license" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M15 21h-9a3 3 0 0 1 -3 -3v-1h10v2a2 2 0 0 0 4 0v-14a2 2 0 1 1 2 2h-2m2 -4h-11a3 3 0 0 0 -3 3v11" />
            <path d="M9 7l4 0" />
            <path d="M9 11l4 0" />
        </svg>
            <span>License</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a   >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 10l6 6l6 -6h-12" />
        </svg>
            <span>Syntax Highlight</span>
        </a>
        
    <div class="navmenu toggle">
        
    <div class="navitem " id="coding-horror">
        <a   onclick="document.body.syntaxHighlight('coding-horror')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Coding Horror</span>
        </a>
        
    </div>
    <div class="navitem " id="monokai">
        <a   onclick="document.body.syntaxHighlight('monokai')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Monokai</span>
        </a>
        
    </div>
    <div class="navitem " id="solarized-light">
        <a   onclick="document.body.syntaxHighlight('solarized-light')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Solarized Light</span>
        </a>
        
    </div>
    <div class="navitem active" id="son-of-obsidian">
        <a   onclick="document.body.syntaxHighlight('son-of-obsidian')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Son of Obsidian</span>
        </a>
        
    </div>
    </div>
    </div>
    </div>
            
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
        </div>
        
        <div class="layout">
            <div class="sidepane narrow-scrollbars">
                
        <div class="tocmenu">
            <h3>Table of Contents</h3>
            
    <ul>
        
    <li>
        
        <a href="../index.html"><span>üè†</span><span data-toggle="tooltip" data-title="Home page">
            Home
        </span></a>
        
    </li>
    <li>
        
        <a href="../introduction.html"><span>ü§ù</span><span data-toggle="tooltip" data-title="Introduction and Motivation">
            Introduction
        </span></a>
        
    </li>
    <li>
        
        <a href="config.html"><span>üéõÔ∏è</span><span data-toggle="tooltip" data-title="Configuration options and command line parsing">
            Configuration
        </span></a>
        
    </li>
    <li>
        
        <a href="templates/toc.html"><span>üìñ</span>Table of Contents</a>
        
    </li>
    <li>
        
        <a href="templates/front-matter.html"><span>üìã</span>Front Matter</a>
        
    </li>
    <li>
        
        <a href="region.html"><span>üåç</span><span data-toggle="tooltip" data-title="Embedding Regions of Code in Markdown">
            Regions
        </span></a>
        
    </li>
    <li>
        
        <a href="dependency-graph.html"><span>üï∏Ô∏è</span><span data-toggle="tooltip" data-title="Creating module dependency graph">
            Dependency Graph
        </span></a>
        
    </li>
    <li>
        
        <a href="bundler.html" class="highlight"><span>üì¶</span><span data-toggle="tooltip" data-title="Packing JS & CSS files">
            Bundler
        </span></a>
        
    </li>
    <li>
        <div class="accordion">
        Site Templates
        </div>
            
    <ul>
        
    <li>
        
        <a href="templates/html.html"><span>üìê</span>HTML Templates</a>
        
    </li>
    <li>
        
        <a href="utils.html"><span>üõ†Ô∏è</span>Utilities</a>
        
    </li>
    <li>
        
        <a href="templates/template.html"><span>üì∞</span>Page Templates</a>
        
    </li>
    <li>
        <div class="accordion">
        Default Template
        </div>
            
    <ul>
        
    <li>
        
        <a href="../site/pages/normal/index.html"><span>üêò</span>Normal Page</a>
        
    </li>
    <li>
        
        <a href="../site/styles/theme.html"><span>üé®</span>Theming</a>
        
    </li>
    </ul>
    </li>
    </ul>
    </li>
    <li>
        <div class="accordion">
        Implementation
        </div>
            
    <ul>
        
    <li>
        
        <a href="index.html"><span>üì∫</span><span data-toggle="tooltip" data-title="Main program and exports">
            Main Program
        </span></a>
        
    </li>
    <li>
        
        <a href="cli.html"><span>üêö</span><span data-toggle="tooltip" data-title="Scaffolding functionality">
            Command Line Interface
        </span></a>
        
    </li>
    <li>
        
        <a href="weaver.html"><span>üï∑Ô∏è</span><span data-toggle="tooltip" data-title="Common code for documentation generation">
            Weaver
        </span></a>
        
    </li>
    <li>
        
        <a href="md-weaver.html"><span>‚úçÔ∏è</span><span data-toggle="tooltip" data-title="Markdown generation code">
            Markdown Weaver
        </span></a>
        
    </li>
    <li>
        
        <a href="html-weaver.html"><span>üîó</span><span data-toggle="tooltip" data-title="HTML generation code">
            HTML Weaver
        </span></a>
        
    </li>
    <li>
        
        <a href="block-list.html"><span>üß±</span><span data-toggle="tooltip" data-title="Data structure for code/markdown fragments">
            Source Blocks
        </span></a>
        
    </li>
    <li>
        <div class="accordion">
        Translators
        </div>
            
    <ul>
        
    <li>
        
        <a href="translators/translators.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Registering and getting translators">
            Translating Input Files
        </span></a>
        
    </li>
    <li>
        
        <a href="translators/base-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Base class and other types related to translators">
            Translator Base Class
        </span></a>
        
    </li>
    <li>
        
        <a href="translators/md-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Translator for markdown files">
            Markdown Translator
        </span></a>
        
    </li>
    <li>
        
        <a href="translators/ts-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Common code for TypeScript translator">
            TypeScript Translator
        </span></a>
        
    </li>
    <li>
        
        <a href="translators/ts-html-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Translating TypeScript to HTML">
            TypeScript Translator for HTML Output
        </span></a>
        
    </li>
    <li>
        
        <a href="translators/jsdoc-translator.html"><span>üó£Ô∏è</span>Generic JSDoc Translator</a>
        
    </li>
    </ul>
    </li>
    <li>
        
        <a href="logging.html"><span>üìí</span><span data-toggle="tooltip" data-title="Outputting errors and progress to console">
            Logging
        </span></a>
        
    </li>
    </ul>
    </li>
    <li>
        
        <a href="../license.html"><span>üìú</span><span data-toggle="tooltip" data-title="License and usage information">
            License
        </span></a>
        
    </li>
    </ul>
        </div>
                <div class="toc-button"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-right" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M7 7l5 5l-5 5" />
            <path d="M13 7l5 5l-5 5" />
        </svg></div>
            </div>
            
        <div class="contentarea closepopups">
            <h1 id="bundling-js-and-css-files">Bundling JS and CSS Files</h1>
<p>HTML files need auxiliary JavaScript and style files to function properly.
The template package provides these files but does not deploy them. There
might be dozens of CSS and JS files needed by various elements in a page.
To make the deployment simpler we use <a href="https://esbuild.github.io/">esbuild</a> to bundle the files.</p>
<p>Bundling takes a root file, typically a JS or TS file, finds all the
dependencies of the root file no matter how deep they are, and packs them
to output file(s). There will be a bundled JS file for each root file.
If you have CSS or files in your dependency graph, those will be combined to
a single CSS file.</p>
<p>The goal is to have fewer JS and CSS files to deploy, thus making the
page loading times faster. To learn more about Webpack operation refer to
the excellent documentation on its <a href="https://esbuild.github.io/">home page</a>.</p>
<details>
<summary>bundler imports</summary>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="999" data-toggle="tooltip" data-title="path.PlatformPath">path</span> <span class="keyword">from</span> <span class="string">&#039;path&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="1029" data-toggle="tooltip" data-title="typeof eb">eb</span> <span class="keyword">from</span> <span class="string">&#039;esbuild&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="1060" data-toggle="tooltip" data-title="typeof cfg">cfg</span> <span class="keyword">from</span> <span class="string">&#039;./config&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="1093" data-toggle="tooltip" data-title="typeof log">log</span> <span class="keyword">from</span> <span class="string">&#039;./logging&#039;</span>
</code></pre>
</details>
<h2 id="gathering-root-files">Gathering Root Files</h2>
<p>The set of root files for the bundle are maintained in a dictionary in the
<a href="html-weaver.html">HtmlWeaver class</a>. The dictionary is defined here.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">interface</span> <span id="1119" class="typename" data-toggle="tooltip" data-title="EntryPoints">EntryPoints</span> <span class="punctuation">{</span>
    <span class="punctuation">[</span><span id="1368" data-toggle="tooltip" data-title="string">name</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">]</span><span class="punctuation">:</span> <span class="keyword">string</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="notifying-when-bundle-is-ready">Notifying When Bundle Is Ready</h2>
<p>By default, esbuild watch mode does not notify the user when the bundle is
ready. We need to define a plugin that hooks to the <code>onEnd</code> event and outputs
info to the console.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">let</span> <span id="1638" data-toggle="tooltip" data-title="eb.Plugin">readyPlugin</span><span class="punctuation">:</span> <a href="bundler.html#1029"><span data-toggle="tooltip" data-title="any">eb</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="eb.Plugin">Plugin</span> <span class="punctuation">=</span> <span class="punctuation">{</span>
    <span id="1665" data-toggle="tooltip" data-title="string">name</span><span class="punctuation">:</span> <span class="string">&quot;bundleReady&quot;</span><span class="punctuation">,</span>
    <span id="1691" class="member" data-toggle="tooltip" data-title="(build: eb.PluginBuild) =&gt; void">setup</span><span class="punctuation">(</span><span id="1703" data-toggle="tooltip" data-title="eb.PluginBuild">build</span><span class="punctuation">:</span> <a href="bundler.html#1029"><span data-toggle="tooltip" data-title="any">eb</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="eb.PluginBuild">PluginBuild</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="bundler.html#1703"><span data-toggle="tooltip" data-title="eb.PluginBuild">build</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(callback: (result: eb.BuildResult&lt;eb.BuildOptions&gt;) =&gt; void | eb.OnEndResult | Promise&lt;void | eb.OnEndResult&gt;) =&gt; void">onEnd</span><span class="punctuation">(</span><a href="bundler.html#1093"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#3336"><span class="member" data-toggle="tooltip" data-title="(result: eb.BuildResult&lt;eb.BuildOptions&gt;) =&gt; void">reportBuildResults</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="esbuild-configuration">Esbuild Configuration</h2>
<p>The esbuild configuration is returned by the function below.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="1782" class="member" data-toggle="tooltip" data-title="(opts: cfg.Options, entries: EntryPoints) =&gt; eb.BuildOptions">buildOptions</span><span class="punctuation">(</span><span id="1915" data-toggle="tooltip" data-title="cfg.Options">opts</span><span class="punctuation">:</span> <a href="bundler.html#1060"><span data-toggle="tooltip" data-title="any">cfg</span></a><span class="punctuation">.</span><a href="config.html#1430"><span class="typename" data-toggle="tooltip" data-title="cfg.Options">Options</span></a><span class="punctuation">,</span> <span id="1933" data-toggle="tooltip" data-title="EntryPoints">entries</span><span class="punctuation">:</span> <a href="bundler.html#1119"><span class="typename" data-toggle="tooltip" data-title="EntryPoints">EntryPoints</span></a><span class="punctuation">)</span><span class="punctuation">:</span> <a href="bundler.html#1029"><span data-toggle="tooltip" data-title="any">eb</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="eb.BuildOptions">BuildOptions</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="punctuation">{</span>
        <span id="1988" data-toggle="tooltip" data-title="true">bundle</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span>
        <span id="2011" data-toggle="tooltip" data-title="EntryPoints">entryPoints</span><span class="punctuation">:</span> <a href="bundler.html#1933"><span data-toggle="tooltip" data-title="EntryPoints">entries</span></a><span class="punctuation">,</span>
</code></pre>
<p>The resolve setting specifies which extensions are appended to import
statements when dependencies are resolved and in which order.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span id="2042" data-toggle="tooltip" data-title="string[]">resolveExtensions</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&#039;.ts&#039;</span><span class="punctuation">,</span> <span class="string">&#039;.js&#039;</span><span class="punctuation">,</span> <span class="string">&#039;.css&#039;</span><span class="punctuation">]</span><span class="punctuation">,</span>
</code></pre>
<p>The output setting specifies where the packed JS file will be saved.
We put them into <code>dist/</code> subfolder in the output directory. The name
of the output file is copied from the root file.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span id="2276" data-toggle="tooltip" data-title="string">outdir</span><span class="punctuation">:</span> <a href="bundler.html#999"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...paths: string[]) =&gt; string">resolve</span><span class="punctuation">(</span><a href="bundler.html#1915"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#1905"><span data-toggle="tooltip" data-title="string">outDir</span></a><span class="punctuation">,</span> <span class="string">&quot;dist&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>
</code></pre>
<p>Optimization settings instruct the bundler to minimize generated JS
and CSS. JS minimizer is included with Webpack, but for CSS
minimization we need additional plugin.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span id="2579" data-toggle="tooltip" data-title="boolean">minify</span><span class="punctuation">:</span> <a href="bundler.html#1915"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5920"><span data-toggle="tooltip" data-title="&quot;dev&quot; | &quot;prod&quot;">deployMode</span></a> <span class="punctuation">==</span> <span class="string">&#039;prod&#039;</span><span class="punctuation">,</span>
</code></pre>
<p>Setup the ready plugin.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span id="2855" data-toggle="tooltip" data-title="eb.Plugin[]">plugins</span><span class="punctuation">:</span> <span class="punctuation">[</span> <a href="bundler.html#1638"><span data-toggle="tooltip" data-title="eb.Plugin">readyPlugin</span></a> <span class="punctuation">]</span><span class="punctuation">,</span>
</code></pre>
<p>Source map enabled for dev builds</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span id="2952" data-toggle="tooltip" data-title="boolean">sourcemap</span><span class="punctuation">:</span> <a href="bundler.html#1915"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5920"><span data-toggle="tooltip" data-title="&quot;dev&quot; | &quot;prod&quot;">deployMode</span></a> <span class="punctuation">==</span> <span class="string">&#039;dev&#039;</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="bundling-files">Bundling Files</h2>
<p>The bundling function is straightforward. We initialize the configuration
passing the configuration and code files to the function above. Depending on
whether we are in watch mode we call eiher <code>watch</code> or <code>build</code>. The former runs
forever in the background monitoring the input files. It reruns automatically
whenever any file in the dependency graph changes. The latter runs only one
time.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">var</span> <span id="3541" data-toggle="tooltip" data-title="boolean">done</span> <span class="punctuation">=</span> <span class="keyword">false</span>

<span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span id="3554" class="member" data-toggle="tooltip" data-title="(entries: EntryPoints) =&gt; Promise&lt;void&gt;">bundle</span><span class="punctuation">(</span><span id="3587" data-toggle="tooltip" data-title="EntryPoints">entries</span><span class="punctuation">:</span> <a href="bundler.html#1119"><span class="typename" data-toggle="tooltip" data-title="EntryPoints">EntryPoints</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="3619" data-toggle="tooltip" data-title="cfg.Options">opts</span> <span class="punctuation">=</span> <a href="bundler.html#1060"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#8163"><span class="member" data-toggle="tooltip" data-title="() =&gt; cfg.Options">getOptions</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <a href="bundler.html#3541"><span data-toggle="tooltip" data-title="boolean">done</span></a> <span class="punctuation">=</span> <span class="keyword">false</span>
    <span class="keyword">try</span> <span class="punctuation">{</span>
        <a href="bundler.html#1093"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#4998"><span class="member" data-toggle="tooltip" data-title="(output: string) =&gt; void">info</span></a><span class="punctuation">(</span><a href="bundler.html#1093"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#346"><span class="typename" data-toggle="tooltip" data-title="typeof log.Colors">Colors</span></a><span class="punctuation">.</span><a href="logging.html#700"><span data-toggle="tooltip" data-title="log.Colors.Cyan">Cyan</span></a> <span class="punctuation">+</span> <span class="string">&quot;Bundling...&quot;</span><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="3736" data-toggle="tooltip" data-title="eb.BuildOptions">buildOpts</span> <span class="punctuation">=</span> <a href="bundler.html#1782"><span class="member" data-toggle="tooltip" data-title="(opts: cfg.Options, entries: EntryPoints) =&gt; eb.BuildOptions">buildOptions</span></a><span class="punctuation">(</span><a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">,</span> <a href="bundler.html#3587"><span data-toggle="tooltip" data-title="EntryPoints">entries</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5240"><span data-toggle="tooltip" data-title="boolean">watch</span></a> <span class="punctuation">||</span> <a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5442"><span data-toggle="tooltip" data-title="boolean">serve</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="3834" data-toggle="tooltip" data-title="eb.BuildContext&lt;eb.BuildOptions&gt;">ctx</span> <span class="punctuation">=</span> <span class="keyword">await</span> <a href="bundler.html#1029"><span data-toggle="tooltip" data-title="typeof eb">eb</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;T extends eb.BuildOptions&gt;(options: eb.SameShape&lt;eb.BuildOptions, T&gt;) =&gt; Promise&lt;eb.BuildContext&lt;T&gt;&gt;">context</span><span class="punctuation">(</span><a href="bundler.html#3736"><span data-toggle="tooltip" data-title="eb.BuildOptions">buildOpts</span></a><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="bundler.html#3834"><span data-toggle="tooltip" data-title="eb.BuildContext&lt;eb.BuildOptions&gt;">ctx</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(options?: eb.WatchOptions) =&gt; Promise&lt;void&gt;">watch</span><span class="punctuation">(</span><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5442"><span data-toggle="tooltip" data-title="boolean">serve</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="keyword">let</span> <span class="punctuation">{</span> <span id="3953" data-toggle="tooltip" data-title="number">port</span><span class="punctuation">,</span> <span id="3959" data-toggle="tooltip" data-title="string">host</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <span class="keyword">await</span> <a href="bundler.html#3834"><span data-toggle="tooltip" data-title="eb.BuildContext&lt;eb.BuildOptions&gt;">ctx</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(options?: eb.ServeOptions) =&gt; Promise&lt;eb.ServeResult&gt;">serve</span><span class="punctuation">(</span><span class="punctuation">{</span>
                    <span id="3986" data-toggle="tooltip" data-title="string">host</span><span class="punctuation">:</span> <a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5888"><span data-toggle="tooltip" data-title="cfg.ServeOptions">serveOptions</span></a><span class="punctuation">.</span><a href="config.html#6569"><span data-toggle="tooltip" data-title="string">host</span></a><span class="punctuation">,</span>
                    <span id="4037" data-toggle="tooltip" data-title="number">port</span><span class="punctuation">:</span> <a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5888"><span data-toggle="tooltip" data-title="cfg.ServeOptions">serveOptions</span></a><span class="punctuation">.</span><a href="config.html#6676"><span data-toggle="tooltip" data-title="number">port</span></a><span class="punctuation">,</span>
                    <span id="4088" data-toggle="tooltip" data-title="string">servedir</span><span class="punctuation">:</span> <a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#1905"><span data-toggle="tooltip" data-title="string">outDir</span></a><span class="punctuation">,</span>
                    <span id="4132" data-toggle="tooltip" data-title="string">keyfile</span><span class="punctuation">:</span> <a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5888"><span data-toggle="tooltip" data-title="cfg.ServeOptions">serveOptions</span></a><span class="punctuation">.</span><a href="config.html#6774"><span data-toggle="tooltip" data-title="string">keyFile</span></a><span class="punctuation">,</span>
                    <span id="4189" data-toggle="tooltip" data-title="string">certfile</span><span class="punctuation">:</span> <a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5888"><span data-toggle="tooltip" data-title="cfg.ServeOptions">serveOptions</span></a><span class="punctuation">.</span><a href="config.html#7016"><span data-toggle="tooltip" data-title="string">certFile</span></a>
                <span class="punctuation">}</span><span class="punctuation">)</span>
                <span class="keyword">let</span> <span id="4288" data-toggle="tooltip" data-title="string">ssl</span> <span class="punctuation">=</span> <a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5888"><span data-toggle="tooltip" data-title="cfg.ServeOptions">serveOptions</span></a><span class="punctuation">.</span><a href="config.html#7016"><span data-toggle="tooltip" data-title="string">certFile</span></a> <span class="punctuation">&amp;&amp;</span> <a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5888"><span data-toggle="tooltip" data-title="cfg.ServeOptions">serveOptions</span></a><span class="punctuation">.</span><a href="config.html#6774"><span data-toggle="tooltip" data-title="string">keyFile</span></a>
                <span data-toggle="tooltip" data-title="Console">console</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (...data: any[]): void; (message?: any, ...optionalParams: any[]): void; }">log</span><span class="punctuation">(</span><span class="string">`${</span><a href="bundler.html#1093"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#346"><span class="typename" data-toggle="tooltip" data-title="typeof log.Colors">Colors</span></a><span class="punctuation">.</span><a href="logging.html#526"><span data-toggle="tooltip" data-title="log.Colors.Reset">Reset</span></a><span class="string">}Development server started at ${</span>
                    <a href="bundler.html#1093"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#346"><span class="typename" data-toggle="tooltip" data-title="typeof log.Colors">Colors</span></a><span class="punctuation">.</span><a href="logging.html#598"><span data-toggle="tooltip" data-title="log.Colors.Green">Green</span></a><span class="string">}http${</span><a href="bundler.html#4288"><span data-toggle="tooltip" data-title="string">ssl</span></a> <span class="punctuation">?</span> <span class="string">&quot;s&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="string">}://${</span><a href="bundler.html#3959"><span data-toggle="tooltip" data-title="string">host</span></a><span class="string">}:${</span><a href="bundler.html#3953"><span data-toggle="tooltip" data-title="number">port</span></a><span class="string">}`</span><span class="punctuation">)</span>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span>
        <span class="keyword">else</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="4571" data-toggle="tooltip" data-title="eb.BuildResult&lt;eb.BuildOptions&gt;">result</span> <span class="punctuation">=</span> <span class="keyword">await</span> <a href="bundler.html#1029"><span data-toggle="tooltip" data-title="typeof eb">eb</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;T extends eb.BuildOptions&gt;(options: eb.SameShape&lt;eb.BuildOptions, T&gt;) =&gt; Promise&lt;eb.BuildResult&lt;T&gt;&gt;">build</span><span class="punctuation">(</span><a href="bundler.html#1782"><span class="member" data-toggle="tooltip" data-title="(opts: cfg.Options, entries: EntryPoints) =&gt; eb.BuildOptions">buildOptions</span></a><span class="punctuation">(</span><a href="bundler.html#3619"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">,</span> <a href="bundler.html#3587"><span data-toggle="tooltip" data-title="EntryPoints">entries</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <a href="bundler.html#1093"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#3336"><span class="member" data-toggle="tooltip" data-title="(result: eb.BuildResult&lt;eb.BuildOptions&gt;) =&gt; void">reportBuildResults</span></a><span class="punctuation">(</span><a href="bundler.html#4571"><span data-toggle="tooltip" data-title="eb.BuildResult&lt;eb.BuildOptions&gt;">result</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span>
        <a href="bundler.html#3541"><span data-toggle="tooltip" data-title="boolean">done</span></a> <span class="punctuation">=</span> <span class="keyword">true</span>
    <span class="punctuation">}</span>
    <span class="keyword">catch</span> <span class="punctuation">(</span><span id="4720" data-toggle="tooltip" data-title="any">e</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="bundler.html#1093"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#4494"><span class="member" data-toggle="tooltip" data-title="(err: Error) =&gt; void">error</span></a><span class="punctuation">(</span><a href="bundler.html#4720"><span data-toggle="tooltip" data-title="any">e</span></a><span class="punctuation">)</span>            
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>To be able to wait the bundle completion, we export a function that polls
the <code>done</code> flag once per second.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span id="4768" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">finished</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">while</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="bundler.html#3541"><span data-toggle="tooltip" data-title="boolean">done</span></a><span class="punctuation">)</span>
        <span class="keyword">await</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="PromiseConstructor">Promise</span><span class="punctuation">(</span><span id="4978" data-toggle="tooltip" data-title="(value: unknown) =&gt; void">resolve</span> <span class="punctuation">=&gt;</span> <span class="member" data-toggle="tooltip" data-title="typeof setTimeout">setTimeout</span><span class="punctuation">(</span><a href="bundler.html#4978"><span data-toggle="tooltip" data-title="(value: unknown) =&gt; void">resolve</span></a><span class="punctuation">,</span> <span class="number">1000</span><span class="punctuation">)</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>

        </div>
            <div class="sidepane narrow-scrollbars">
                
        <div class="pagemenu">
            <h3>On This Page</h3>
                <ul class="pagetree">
                </ul>
        </div>
            </div>
        </div>
        
        <div class="footer">
            <a class="footer-button" href="dependency-graph.html">
            <p>Previous</p>
            <p>¬´ Dependency Graph</p>
        </a>
            <div class="footer-text">
                <p>Copyright ¬© 2023 Tommi Johtela</p>
                <p>Generated by 
                    <a href="https://johtela.github.io/litscript">LiTScript</a>
                </p>
            </div>
            <a class="footer-button" href="templates/html.html">
            <p>Next</p>
            <p>HTML Templates ¬ª</p>
        </a>
        </div>
    
        <script src="../dist/normal.js"></script>
    </body>
    </html>