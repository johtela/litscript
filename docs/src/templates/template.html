
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>
            LiTScript - Page Templates
        </title>
        <link rel="icon" type="image/icon" href="../../images/favicon.png" />
        <link rel="stylesheet" href="../../dist/normal.css" />
        
    </head>
    <body data-syntax-highlight="son-of-obsidian">
        
        <div id="navbar">
            
    <div class="navmenu ">
        
    <div class="navitem " >
        <a class="title enabled" href="../../index.html" >
            <img src="../../images/bulb.svg" />
            <span>LiTScript</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://www.npmjs.com/package/litscript" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-npm" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M1 8h22v7h-12v2h-4v-2h-6z" />
            <path d="M7 8v7" />
            <path d="M14 8v7" />
            <path d="M17 11v4" />
            <path d="M4 11v4" />
            <path d="M11 11v1" />
            <path d="M20 11v4" />
        </svg>
            <span>Download</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://github.com/johtela/litscript" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
        </svg>
            <span>GitHub</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="../../license.html" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-license" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M15 21h-9a3 3 0 0 1 -3 -3v-1h10v2a2 2 0 0 0 4 0v-14a2 2 0 1 1 2 2h-2m2 -4h-11a3 3 0 0 0 -3 3v11" />
            <path d="M9 7l4 0" />
            <path d="M9 11l4 0" />
        </svg>
            <span>License</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a   >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 10l6 6l6 -6h-12" />
        </svg>
            <span>Syntax Highlight</span>
        </a>
        
    <div class="navmenu toggle">
        
    <div class="navitem " id="coding-horror">
        <a   onclick="document.body.syntaxHighlight('coding-horror')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Coding Horror</span>
        </a>
        
    </div>
    <div class="navitem " id="monokai">
        <a   onclick="document.body.syntaxHighlight('monokai')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Monokai</span>
        </a>
        
    </div>
    <div class="navitem " id="solarized-light">
        <a   onclick="document.body.syntaxHighlight('solarized-light')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Solarized Light</span>
        </a>
        
    </div>
    <div class="navitem active" id="son-of-obsidian">
        <a   onclick="document.body.syntaxHighlight('son-of-obsidian')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Son of Obsidian</span>
        </a>
        
    </div>
    </div>
    </div>
    </div>
            
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
        </div>
        
        <div class="layout">
            <div class="sidepane narrow-scrollbars">
                
        <div class="tocmenu">
            <h3>Table of Contents</h3>
            
    <ul>
        
    <li>
        <a href="../../index.html"><span>üè†</span><span data-toggle="tooltip" data-title="Home page">
            Home
        </span></a>
    </li>
    <li>
        <a href="../../introduction.html"><span>ü§ù</span><span data-toggle="tooltip" data-title="Introduction and Motivation">
            Introduction
        </span></a>
    </li>
    <li>
        <a href="../config.html"><span>üéõÔ∏è</span><span data-toggle="tooltip" data-title="Configuration options and command line parsing">
            Configuration
        </span></a>
    </li>
    <li>
        <a href="toc.html"><span>üìñ</span>Table of Contents</a>
    </li>
    <li>
        <a href="front-matter.html"><span>üìã</span>Front Matter</a>
    </li>
    <li>
        <a href="../region.html"><span>üåç</span><span data-toggle="tooltip" data-title="Embedding Regions of Code in Markdown">
            Regions
        </span></a>
    </li>
    <li>
        <a href="../dependency-graph.html"><span>üï∏Ô∏è</span><span data-toggle="tooltip" data-title="Creating module dependency graph">
            Dependency Graph
        </span></a>
    </li>
    <li>
        <a href="../bundler.html"><span>üì¶</span><span data-toggle="tooltip" data-title="Packing JS & CSS files">
            Bundler
        </span></a>
    </li>
    <li>
        <a href="../server.html"><span>üì°</span><span data-toggle="tooltip" data-title="Development server setup">
            Server
        </span></a>
    </li>
    <li>
        
    <div class="accordion">
        Site Templates
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="template.html" class="highlight"><span>üì∞</span><span data-toggle="tooltip" data-title="Creating static web pages">
            Page Templates
        </span></a>
    </li>
    <li>
        <a href="html.html"><span>üìê</span>HTML Template Literals</a>
    </li>
    <li>
        <a href="../utils.html"><span>üõ†Ô∏è</span>Utilities</a>
    </li>
    <li>
        
    <div class="accordion">
        Default Template
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="../../site/pages/normal/index.html"><span>üêò</span>Normal Page</a>
    </li>
    <li>
        <a href="../../site/styles/theme.html"><span>üé®</span>Theming</a>
    </li>
    </ul>
    </li>
    </ul>
    </li>
    <li>
        
    <div class="accordion">
        Implementation
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="../index.html"><span>üì∫</span><span data-toggle="tooltip" data-title="Main program and exports">
            Main Program
        </span></a>
    </li>
    <li>
        <a href="../cli.html"><span>üêö</span><span data-toggle="tooltip" data-title="Scaffolding functionality">
            Command Line Interface
        </span></a>
    </li>
    <li>
        <a href="../weaver.html"><span>üï∑Ô∏è</span><span data-toggle="tooltip" data-title="Common code for documentation generation">
            Weaver
        </span></a>
    </li>
    <li>
        <a href="../md-weaver.html"><span>‚úçÔ∏è</span><span data-toggle="tooltip" data-title="Markdown generation code">
            Markdown Weaver
        </span></a>
    </li>
    <li>
        <a href="../html-weaver.html"><span>üîó</span><span data-toggle="tooltip" data-title="HTML generation code">
            HTML Weaver
        </span></a>
    </li>
    <li>
        <a href="../block-list.html"><span>üß±</span><span data-toggle="tooltip" data-title="Data structure for code/markdown fragments">
            Source Blocks
        </span></a>
    </li>
    <li>
        
    <div class="accordion">
        Translators
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="../translators/translators.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Registering and getting translators">
            Translating Input Files
        </span></a>
    </li>
    <li>
        <a href="../translators/base-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Base class and other types related to translators">
            Translator Base Class
        </span></a>
    </li>
    <li>
        <a href="../translators/md-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Translator for markdown files">
            Markdown Translator
        </span></a>
    </li>
    <li>
        <a href="../translators/ts-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Common code for TypeScript translator">
            TypeScript Translator
        </span></a>
    </li>
    <li>
        <a href="../translators/ts-html-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Translating TypeScript to HTML">
            TypeScript Translator for HTML Output
        </span></a>
    </li>
    <li>
        <a href="../translators/jsdoc-translator.html"><span>üó£Ô∏è</span>Generic JSDoc Translator</a>
    </li>
    </ul>
    </li>
    <li>
        <a href="../logging.html"><span>üìí</span><span data-toggle="tooltip" data-title="Outputting errors and progress to console">
            Logging
        </span></a>
    </li>
    </ul>
    </li>
    <li>
        <a href="../../license.html"><span>üìú</span><span data-toggle="tooltip" data-title="License and usage information">
            License
        </span></a>
    </li>
    </ul>
        </div>
                <div class="toc-button"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-right" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M7 7l5 5l-5 5" />
            <path d="M13 7l5 5l-5 5" />
        </svg></div>
            </div>
            
        <div class="contentarea closepopups">
            <h1 id="generating-html-pages-with-templates">Generating HTML Pages with Templates</h1>
<p>Templating functionality has changed considerably from LiTScript version 1.x.
Starting from version 2.0, templates are no longer external
projects/libraries. Templates reside now under the <code>&lt;baseDir&gt;/site/pages</code>
directory. Any LiTScript project can define its own templates or just use the
built-in ones.</p>
<p>A template does not need implement any interfaces. It is simply a function
that returns the HTML for given input page.</p>
<details>
<summary>template.ts imports</summary>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="556" data-toggle="tooltip" data-title="path.PlatformPath">path</span> <span class="keyword">from</span> <span class="string">&#039;path&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="586" data-toggle="tooltip" data-title="typeof fs">fs</span> <span class="keyword">from</span> <span class="string">&#039;fs&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="612" data-toggle="tooltip" data-title="typeof toc">toc</span> <span class="keyword">from</span> <span class="string">&#039;./toc&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="642" data-toggle="tooltip" data-title="typeof fm">fm</span> <span class="keyword">from</span> <span class="string">&#039;./front-matter&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="680" data-toggle="tooltip" data-title="typeof utils">utils</span> <span class="keyword">from</span> <span class="string">&#039;../utils&#039;</span>
<span class="keyword">import</span> <span class="punctuation">{</span> <span id="717" data-toggle="tooltip" data-title="typeof HtmlTemplate">HtmlTemplate</span><span class="punctuation">,</span> <span id="731" data-toggle="tooltip" data-title="(template: HtmlTemplate, fileName: string) =&gt; void">saveHtmlTemplate</span> <span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">&#039;./html&#039;</span><span class="punctuation">;</span>
</code></pre>
</details>
<h2 id="template-context">Template Context</h2>
<p>A template function is passed a context object that contains data needed for
generating HTML and methods to add new files for the bundler.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">class</span> <span id="765" class="typename" data-toggle="tooltip" data-title="TemplateContext">TemplateContext</span> <span class="punctuation">{</span>
</code></pre>
<p>All the modules referenced by calling <code>require</code> method are stored in
this property.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="998" data-toggle="tooltip" data-title="string[]">modules</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">[</span><span class="punctuation">]</span> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<p>The constructor takes all the required data as a parameter and stores
them in read-only properties.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span class="keyword">constructor</span><span class="punctuation">(</span>
</code></pre>
<p>Front matter that comes from the configuration or from the source
file.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="1297" data-toggle="tooltip" data-title="fm.FrontMatter">frontMatter</span><span class="punctuation">:</span> <a href="template.html#642"><span data-toggle="tooltip" data-title="any">fm</span></a><span class="punctuation">.</span><a href="front-matter.html#0"><span class="typename" data-toggle="tooltip" data-title="fm.FrontMatter">FrontMatter</span></a><span class="punctuation">,</span>
</code></pre>
<p>Table of contents data structure generated by the weaver.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="1467" data-toggle="tooltip" data-title="toc.Toc">toc</span><span class="punctuation">:</span> <a href="template.html#612"><span data-toggle="tooltip" data-title="any">toc</span></a><span class="punctuation">.</span><a href="toc.html#227"><span class="typename" data-toggle="tooltip" data-title="toc.Toc">Toc</span></a><span class="punctuation">,</span>
</code></pre>
<p>The actual documentation contents of the file in HTML format.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="1595" data-toggle="tooltip" data-title="string">contents</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span>
</code></pre>
<p>The relative path of the output file. The path is relative to
<code>outDir</code>.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="1731" data-toggle="tooltip" data-title="string">relFilePath</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span>
</code></pre>
<p>The fully resolved path of the output file.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="1893" data-toggle="tooltip" data-title="string">fullFilePath</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span>
</code></pre>
<p>The base directory of the project.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="2015" data-toggle="tooltip" data-title="string">baseDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span>
</code></pre>
<p>The site directory where the <em>compiled</em> templates reside.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="2123" data-toggle="tooltip" data-title="string">siteDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span>
</code></pre>
<p>The output directory for HTML files.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="2254" data-toggle="tooltip" data-title="string">outDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span>
</code></pre>
<p>Style <code>&lt;link&gt;</code> tags to be added to the head section.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="2363" data-toggle="tooltip" data-title="string">styles</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span>
</code></pre>
<p><code>&lt;script&gt;</code> tags to be added at the end of the body.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">readonly</span> <span id="2488" data-toggle="tooltip" data-title="string">scripts</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span> <span class="punctuation">}</span>
</code></pre>
<h2 id="importing-script-and-style-files">Importing Script and Style Files</h2>
<p>Modules and style files required by the template can be imported with the
<code>require</code> method. It adds the referred TS, JS, or CSS file into the
<code>modules</code> array, if it's not already there.</p>
<p>The method takes directory and module path as parameter and resolves them
to an absolute path. Reason why the path is given in two parts is to make
referring to modules in different source directories more convenient.</p>
<p>We also check that the given path exists. This makes debugging templates
easier as missing modules are noticed before bundling phase. If the file
has no extension, <code>.js</code> is appended to the path. As the final
transformation we convert the module path to be relative to the <code>main</code>
directory under the <code>&lt;siteDir&gt;</code>. See below why we do that.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="2617" class="member" data-toggle="tooltip" data-title="(dir: string, modPath: string) =&gt; void">require</span><span class="punctuation">(</span><span id="3552" data-toggle="tooltip" data-title="string">dir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="3564" data-toggle="tooltip" data-title="string">modPath</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="3596" data-toggle="tooltip" data-title="string">module</span> <span class="punctuation">=</span> <a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...paths: string[]) =&gt; string">resolve</span><span class="punctuation">(</span><a href="template.html#3552"><span data-toggle="tooltip" data-title="string">dir</span></a><span class="punctuation">,</span> <a href="template.html#3564"><span data-toggle="tooltip" data-title="string">modPath</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: string) =&gt; string">extname</span><span class="punctuation">(</span><a href="template.html#3596"><span data-toggle="tooltip" data-title="string">module</span></a><span class="punctuation">)</span> <span class="punctuation">==</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span>
            <a href="template.html#3596"><span data-toggle="tooltip" data-title="string">module</span></a> <span class="punctuation">+=</span> <span class="string">&quot;.js&quot;</span>
        <a href="template.html#3953"><span class="member" data-toggle="tooltip" data-title="(ctx: TemplateContext) =&gt; void">checkModuleExists</span></a><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="3748" data-toggle="tooltip" data-title="string">mainDir</span> <span class="punctuation">=</span> <a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...paths: string[]) =&gt; string">resolve</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">.</span><a href="template.html#2123"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">,</span> <span class="string">&quot;main/&quot;</span><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="3807" data-toggle="tooltip" data-title="string">modpath</span> <span class="punctuation">=</span> <a href="template.html#680"><span data-toggle="tooltip" data-title="typeof utils">utils</span></a><span class="punctuation">.</span><a href="../utils.html#87"><span class="member" data-toggle="tooltip" data-title="(filePath: string) =&gt; string">toPosixPath</span></a><span class="punctuation">(</span><a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(from: string, to: string) =&gt; string">relative</span><span class="punctuation">(</span><a href="template.html#3748"><span data-toggle="tooltip" data-title="string">mainDir</span></a><span class="punctuation">,</span> <a href="template.html#3596"><span data-toggle="tooltip" data-title="string">module</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><span class="keyword">this</span><span class="punctuation">.</span><a href="template.html#998"><span data-toggle="tooltip" data-title="string[]">modules</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(searchElement: string, fromIndex?: number) =&gt; boolean">includes</span><span class="punctuation">(</span><a href="template.html#3807"><span data-toggle="tooltip" data-title="string">modpath</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="keyword">this</span><span class="punctuation">.</span><a href="template.html#998"><span data-toggle="tooltip" data-title="string[]">modules</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: string[]) =&gt; number">push</span><span class="punctuation">(</span><a href="template.html#3807"><span data-toggle="tooltip" data-title="string">modpath</span></a><span class="punctuation">)</span>
</code></pre>
<p>Checking that the module exists is a bit involved operation because
TypeScript compiler does not copy CSS files to the output directory.
This makes referring to them from templates tricky. We would like to
specify a relative path starting from the module's location directory
available in the <code>__dirname</code> variable. But when the compiled JS code
evaluates this variable it gets the compiler's ouput directory, not
the template source directory.</p>
<p>We solve the problem like this: If the module is not found under the
given path, we check whether it resides under the <code>siteDir</code>. If so,
we replace the <code>siteDir</code> with <code>&lt;baseDir&gt;\site</code>, which is the
corresponding source directory and check again. If still cannot find
the module, we throw an exception.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="keyword">function</span> <span id="3953" class="member" data-toggle="tooltip" data-title="(ctx: TemplateContext) =&gt; void">checkModuleExists</span><span class="punctuation">(</span><span id="4928" data-toggle="tooltip" data-title="TemplateContext">ctx</span><span class="punctuation">:</span> <a href="template.html#765"><span class="typename" data-toggle="tooltip" data-title="TemplateContext">TemplateContext</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="template.html#586"><span data-toggle="tooltip" data-title="typeof fs">fs</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: fs.PathLike) =&gt; boolean">existsSync</span><span class="punctuation">(</span><a href="template.html#3596"><span data-toggle="tooltip" data-title="string">module</span></a><span class="punctuation">)</span><span class="punctuation">)</span> 
                <span class="keyword">return</span>
            <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="template.html#680"><span data-toggle="tooltip" data-title="typeof utils">utils</span></a><span class="punctuation">.</span><a href="../utils.html#326"><span class="member" data-toggle="tooltip" data-title="(filePath: string, dir: string) =&gt; boolean">isInsideDir</span></a><span class="punctuation">(</span><a href="template.html#3596"><span data-toggle="tooltip" data-title="string">module</span></a><span class="punctuation">,</span> <a href="template.html#4928"><span data-toggle="tooltip" data-title="TemplateContext">ctx</span></a><span class="punctuation">.</span><a href="template.html#2123"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="keyword">let</span> <span id="5101" data-toggle="tooltip" data-title="string">relPath</span> <span class="punctuation">=</span> <a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(from: string, to: string) =&gt; string">relative</span><span class="punctuation">(</span><a href="template.html#4928"><span data-toggle="tooltip" data-title="TemplateContext">ctx</span></a><span class="punctuation">.</span><a href="template.html#2123"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">,</span> <a href="template.html#3596"><span data-toggle="tooltip" data-title="string">module</span></a><span class="punctuation">)</span>
                <a href="template.html#3596"><span data-toggle="tooltip" data-title="string">module</span></a> <span class="punctuation">=</span> <a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...paths: string[]) =&gt; string">resolve</span><span class="punctuation">(</span><a href="template.html#4928"><span data-toggle="tooltip" data-title="TemplateContext">ctx</span></a><span class="punctuation">.</span><a href="template.html#2015"><span data-toggle="tooltip" data-title="string">baseDir</span></a><span class="punctuation">,</span> <span class="string">&quot;site/&quot;</span><span class="punctuation">,</span> <a href="template.html#5101"><span data-toggle="tooltip" data-title="string">relPath</span></a><span class="punctuation">)</span>
                <a href="template.html#3953"><span class="member" data-toggle="tooltip" data-title="(ctx: TemplateContext) =&gt; void">checkModuleExists</span></a><span class="punctuation">(</span><a href="template.html#4928"><span data-toggle="tooltip" data-title="TemplateContext">ctx</span></a><span class="punctuation">)</span>
            <span class="punctuation">}</span>
            <span class="keyword">else</span>
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="ErrorConstructor">Error</span><span class="punctuation">(</span><span class="string">`Cannot find module &quot;${</span><a href="template.html#3596"><span data-toggle="tooltip" data-title="string">module</span></a><span class="string">}&quot;`</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="template-function">Template Function</h2>
<p>A template is a function that gets a TemplateContext object as an argument
and returns a <a href="./html.html">HTML template literal</a>. The HtmlTemplate object
can be then efficiently outputted to a file.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">type</span> <span id="5377" class="typename" data-toggle="tooltip" data-title="Template">Template</span> <span class="punctuation">=</span> <span class="punctuation">(</span><span id="5652" data-toggle="tooltip" data-title="TemplateContext">ctx</span><span class="punctuation">:</span> <a href="template.html#765"><span class="typename" data-toggle="tooltip" data-title="TemplateContext">TemplateContext</span></a><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <a href="template.html#717"><span data-toggle="tooltip" data-title="HtmlTemplate">HtmlTemplate</span></a>
</code></pre>
<p>Page templates live under the <code>&lt;baseDir&gt;/site</code> directory. They are loaded
dynamically when a page is generated. To prevent unnecessary reloads, we
cache the loedded templates in a dictionary. Its keys are template names and
values are template functions.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">let</span> <span id="5976" data-toggle="tooltip" data-title="Record&lt;string, Template&gt;">templates</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Record&lt;K, T&gt;">Record</span><span class="punctuation">&lt;</span><span class="keyword">string</span><span class="punctuation">,</span> <a href="template.html#5377"><span class="typename" data-toggle="tooltip" data-title="Template">Template</span></a><span class="punctuation">&gt;</span> <span class="punctuation">=</span> <span class="punctuation">{</span><span class="punctuation">}</span>
</code></pre>
<h2 id="initializing-templates">Initializing Templates</h2>
<p>Before we can generate pages with a template, we must clean up the working
directory at <code>&lt;siteDir&gt;/main</code>. It contains the bundler entry/root files that
import the required modules.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="6017" class="member" data-toggle="tooltip" data-title="(siteDir: string) =&gt; void">initialize</span><span class="punctuation">(</span><span id="6289" data-toggle="tooltip" data-title="string">siteDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="6316" data-toggle="tooltip" data-title="string">mainDir</span> <span class="punctuation">=</span> <a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...paths: string[]) =&gt; string">resolve</span><span class="punctuation">(</span><a href="template.html#6289"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">,</span> <span class="string">&quot;main/&quot;</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="template.html#586"><span data-toggle="tooltip" data-title="typeof fs">fs</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: fs.PathLike) =&gt; boolean">existsSync</span><span class="punctuation">(</span><a href="template.html#6316"><span data-toggle="tooltip" data-title="string">mainDir</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <a href="template.html#680"><span data-toggle="tooltip" data-title="typeof utils">utils</span></a><span class="punctuation">.</span><a href="../utils.html#1186"><span class="member" data-toggle="tooltip" data-title="(dir: string) =&gt; void">clearDir</span></a><span class="punctuation">(</span><a href="template.html#6316"><span data-toggle="tooltip" data-title="string">mainDir</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>When template source code changes, we need to recompile and reload them. The
function below clears the template cache as well as node.js module cache.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="6426" class="member" data-toggle="tooltip" data-title="(siteDir: string) =&gt; void">clearCache</span><span class="punctuation">(</span><span id="6624" data-toggle="tooltip" data-title="string">siteDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="template.html#5976"><span data-toggle="tooltip" data-title="Record&lt;string, Template&gt;">templates</span></a> <span class="punctuation">=</span> <span class="punctuation">{</span><span class="punctuation">}</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="6676" data-toggle="tooltip" data-title="string">mod</span> <span class="keyword">in</span> <span data-toggle="tooltip" data-title="NodeRequire">require</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="NodeJS.Dict&lt;NodeModule&gt;">cache</span><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="template.html#680"><span data-toggle="tooltip" data-title="typeof utils">utils</span></a><span class="punctuation">.</span><a href="../utils.html#326"><span class="member" data-toggle="tooltip" data-title="(filePath: string, dir: string) =&gt; boolean">isInsideDir</span></a><span class="punctuation">(</span><a href="template.html#6676"><span data-toggle="tooltip" data-title="string">mod</span></a><span class="punctuation">,</span> <a href="template.html#6624"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="keyword">delete</span> <span data-toggle="tooltip" data-title="NodeRequire">require</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="NodeJS.Dict&lt;NodeModule&gt;">cache</span><span class="punctuation">[</span><a href="template.html#6676"><span data-toggle="tooltip" data-title="string">mod</span></a><span class="punctuation">]</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="generating-pages">Generating Pages</h2>
<p><code>generate</code> function takes as an argument all the needed properties and:</p>
<ol>
<li>constructs the TemplateContext class,</li>
<li>loads the template,</li>
<li>calls the template function which returns the HTML template literal,</li>
<li>saves the generated page to the output directory, and</li>
<li>returns the name of the used template along with the path to the main
module which is used as the entry for the bundler.</li>
</ol>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="6786" class="member" data-toggle="tooltip" data-title="(fm: fm.FrontMatter, toc: toc.Toc, contents: string, styles: string, scripts: string, fullFilePath: string, relFilePath: string, baseDir: string, siteDir: string, outDir: string) =&gt; [string, string]">generate</span><span class="punctuation">(</span><span id="7284" data-toggle="tooltip" data-title="fm.FrontMatter">fm</span><span class="punctuation">:</span> <a href="template.html#642"><span data-toggle="tooltip" data-title="any">fm</span></a><span class="punctuation">.</span><a href="front-matter.html#0"><span class="typename" data-toggle="tooltip" data-title="fm.FrontMatter">FrontMatter</span></a><span class="punctuation">,</span> <span id="7303" data-toggle="tooltip" data-title="toc.Toc">toc</span><span class="punctuation">:</span> <a href="template.html#612"><span data-toggle="tooltip" data-title="any">toc</span></a><span class="punctuation">.</span><a href="toc.html#227"><span class="typename" data-toggle="tooltip" data-title="toc.Toc">Toc</span></a><span class="punctuation">,</span> <span id="7317" data-toggle="tooltip" data-title="string">contents</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> 
    <span id="7335" data-toggle="tooltip" data-title="string">styles</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="7357" data-toggle="tooltip" data-title="string">scripts</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="7374" data-toggle="tooltip" data-title="string">fullFilePath</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="7396" data-toggle="tooltip" data-title="string">relFilePath</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span>
    <span id="7417" data-toggle="tooltip" data-title="string">baseDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="7439" data-toggle="tooltip" data-title="string">siteDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="7456" data-toggle="tooltip" data-title="string">outDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="keyword">string</span><span class="punctuation">,</span> <span class="keyword">string</span><span class="punctuation">]</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="7501" data-toggle="tooltip" data-title="TemplateContext">ctx</span> <span class="punctuation">=</span> <span class="keyword">new</span> <a href="template.html#765"><span class="typename" data-toggle="tooltip" data-title="typeof TemplateContext">TemplateContext</span></a><span class="punctuation">(</span><a href="template.html#7284"><span data-toggle="tooltip" data-title="fm.FrontMatter">fm</span></a><span class="punctuation">,</span> <a href="template.html#7303"><span data-toggle="tooltip" data-title="toc.Toc">toc</span></a><span class="punctuation">,</span> <a href="template.html#7317"><span data-toggle="tooltip" data-title="string">contents</span></a><span class="punctuation">,</span> <a href="template.html#7396"><span data-toggle="tooltip" data-title="string">relFilePath</span></a><span class="punctuation">,</span> <a href="template.html#7374"><span data-toggle="tooltip" data-title="string">fullFilePath</span></a><span class="punctuation">,</span>
        <a href="template.html#7417"><span data-toggle="tooltip" data-title="string">baseDir</span></a><span class="punctuation">,</span> <a href="template.html#7439"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">,</span> <a href="template.html#7456"><span data-toggle="tooltip" data-title="string">outDir</span></a><span class="punctuation">,</span> <a href="template.html#7335"><span data-toggle="tooltip" data-title="string">styles</span></a><span class="punctuation">,</span> <a href="template.html#7357"><span data-toggle="tooltip" data-title="string">scripts</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="7634" data-toggle="tooltip" data-title="Template">template</span> <span class="punctuation">=</span> <a href="template.html#7839"><span class="member" data-toggle="tooltip" data-title="(siteDir: string, tempName: string) =&gt; Template">loadTemplate</span></a><span class="punctuation">(</span><a href="template.html#7439"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">,</span> <a href="template.html#7284"><span data-toggle="tooltip" data-title="fm.FrontMatter">fm</span></a><span class="punctuation">.</span><a href="front-matter.html#1255"><span data-toggle="tooltip" data-title="string">pageTemplate</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="7693" data-toggle="tooltip" data-title="HtmlTemplate">htmlTemp</span> <span class="punctuation">=</span> <a href="template.html#7634"><span data-toggle="tooltip" data-title="Template">template</span></a><span class="punctuation">(</span><a href="template.html#7501"><span data-toggle="tooltip" data-title="TemplateContext">ctx</span></a><span class="punctuation">)</span>
    <a href="template.html#731"><span data-toggle="tooltip" data-title="(template: HtmlTemplate, fileName: string) =&gt; void">saveHtmlTemplate</span></a><span class="punctuation">(</span><a href="template.html#7693"><span data-toggle="tooltip" data-title="HtmlTemplate">htmlTemp</span></a><span class="punctuation">,</span> <a href="template.html#7374"><span data-toggle="tooltip" data-title="string">fullFilePath</span></a><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">[</span><a href="template.html#7284"><span data-toggle="tooltip" data-title="fm.FrontMatter">fm</span></a><span class="punctuation">.</span><a href="front-matter.html#1255"><span data-toggle="tooltip" data-title="string">pageTemplate</span></a><span class="punctuation">,</span> <a href="template.html#8561"><span class="member" data-toggle="tooltip" data-title="(siteDir: string, tempName: string, ctx: TemplateContext) =&gt; string">saveMain</span></a><span class="punctuation">(</span><a href="template.html#7439"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">,</span> <a href="template.html#7284"><span data-toggle="tooltip" data-title="fm.FrontMatter">fm</span></a><span class="punctuation">.</span><a href="front-matter.html#1255"><span data-toggle="tooltip" data-title="string">pageTemplate</span></a><span class="punctuation">,</span> <a href="template.html#7501"><span data-toggle="tooltip" data-title="TemplateContext">ctx</span></a><span class="punctuation">)</span><span class="punctuation">]</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="loading-template">Loading Template</h2>
<p>The module that contains the named <code>&lt;template&gt;</code> must be located at
<code>&lt;siteDir&gt;/pages/&lt;template&gt;.js</code> or <code>&lt;siteDir&gt;/pages/&lt;template&gt;/index.js</code>.
The template function must be the default export of that module. We use
node.js <code>require</code> function to load the module and get its detault export. If
that succeeds, we store the template in the cache dictionary.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="7839" class="member" data-toggle="tooltip" data-title="(siteDir: string, tempName: string) =&gt; Template">loadTemplate</span><span class="punctuation">(</span><span id="8275" data-toggle="tooltip" data-title="string">siteDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="8291" data-toggle="tooltip" data-title="string">tempName</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="template.html#5377"><span class="typename" data-toggle="tooltip" data-title="Template">Template</span></a> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="8330" data-toggle="tooltip" data-title="Template">temp</span> <span class="punctuation">=</span> <a href="template.html#5976"><span data-toggle="tooltip" data-title="Record&lt;string, Template&gt;">templates</span></a><span class="punctuation">[</span><a href="template.html#8291"><span data-toggle="tooltip" data-title="string">tempName</span></a><span class="punctuation">]</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="template.html#8330"><span data-toggle="tooltip" data-title="Template">temp</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="8388" data-toggle="tooltip" data-title="string">tempFile</span> <span class="punctuation">=</span> <a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...paths: string[]) =&gt; string">resolve</span><span class="punctuation">(</span><a href="template.html#8275"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">,</span> <span class="string">&quot;pages/&quot;</span><span class="punctuation">,</span> <a href="template.html#8291"><span data-toggle="tooltip" data-title="string">tempName</span></a><span class="punctuation">)</span>   
        <a href="template.html#8330"><span data-toggle="tooltip" data-title="Template">temp</span></a> <span class="punctuation">=</span> <span data-toggle="tooltip" data-title="NodeRequire">require</span><span class="punctuation">(</span><a href="template.html#8388"><span data-toggle="tooltip" data-title="string">tempFile</span></a><span class="punctuation">)</span><span class="punctuation">.</span>default <span class="keyword">as</span> <a href="template.html#5377"><span class="typename" data-toggle="tooltip" data-title="Template">Template</span></a>
        <a href="template.html#5976"><span data-toggle="tooltip" data-title="Record&lt;string, Template&gt;">templates</span></a><span class="punctuation">[</span><a href="template.html#8291"><span data-toggle="tooltip" data-title="string">tempName</span></a><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="template.html#8330"><span data-toggle="tooltip" data-title="Template">temp</span></a>
    <span class="punctuation">}</span>
    <span class="keyword">return</span> <a href="template.html#8330"><span data-toggle="tooltip" data-title="Template">temp</span></a>
<span class="punctuation">}</span>
</code></pre>
<h2 id="saving-the-main-module">Saving the Main Module</h2>
<p>The main module is used as the entry file for the bundler. It imports all
required modules which bundler subsequently combines into a single JS or CSS
file. The function below outputs the main module into
<code>&lt;siteDir&gt;/main/&lt;template&gt;.js</code> and returns the path to it.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="8561" class="member" data-toggle="tooltip" data-title="(siteDir: string, tempName: string, ctx: TemplateContext) =&gt; string">saveMain</span><span class="punctuation">(</span><span id="8907" data-toggle="tooltip" data-title="string">siteDir</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="8923" data-toggle="tooltip" data-title="string">tempName</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="8941" data-toggle="tooltip" data-title="TemplateContext">ctx</span><span class="punctuation">:</span> <a href="template.html#765"><span class="typename" data-toggle="tooltip" data-title="TemplateContext">TemplateContext</span></a><span class="punctuation">)</span><span class="punctuation">:</span> 
    <span class="keyword">string</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="8988" data-toggle="tooltip" data-title="string">jsPath</span> <span class="punctuation">=</span> <a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...paths: string[]) =&gt; string">resolve</span><span class="punctuation">(</span><a href="template.html#8907"><span data-toggle="tooltip" data-title="string">siteDir</span></a><span class="punctuation">,</span> <span class="string">`main/${</span><a href="template.html#8923"><span data-toggle="tooltip" data-title="string">tempName</span></a><span class="string">}.js`</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="template.html#586"><span data-toggle="tooltip" data-title="typeof fs">fs</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: fs.PathLike) =&gt; boolean">existsSync</span><span class="punctuation">(</span><a href="template.html#8988"><span data-toggle="tooltip" data-title="string">jsPath</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="template.html#680"><span data-toggle="tooltip" data-title="typeof utils">utils</span></a><span class="punctuation">.</span><a href="../utils.html#532"><span class="member" data-toggle="tooltip" data-title="(filePath: string) =&gt; void">ensureDirExist</span></a><span class="punctuation">(</span><a href="template.html#8988"><span data-toggle="tooltip" data-title="string">jsPath</span></a><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="9128" data-toggle="tooltip" data-title="number">fd</span> <span class="punctuation">=</span> <a href="template.html#586"><span data-toggle="tooltip" data-title="typeof fs">fs</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: fs.PathLike, flags: fs.OpenMode, mode?: fs.Mode) =&gt; number">openSync</span><span class="punctuation">(</span><a href="template.html#8988"><span data-toggle="tooltip" data-title="string">jsPath</span></a><span class="punctuation">,</span> <span class="string">&#039;w&#039;</span><span class="punctuation">)</span>
        <span class="keyword">try</span> <span class="punctuation">{</span>
            <a href="template.html#586"><span data-toggle="tooltip" data-title="typeof fs">fs</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (fd: number, buffer: NodeJS.ArrayBufferView, offset?: number, length?: number, position?: number): number; (fd: number, string: string, position?: number, encoding?: BufferEncoding): number; }">writeSync</span><span class="punctuation">(</span><a href="template.html#9128"><span data-toggle="tooltip" data-title="number">fd</span></a><span class="punctuation">,</span> <span class="string">&#039;&quot;use strict&quot;;\n&#039;</span> <span class="punctuation">+</span>
                <span class="string">&#039;Object.defineProperty(exports, &quot;__esModule&quot;, { value: true });\n&#039;</span><span class="punctuation">,</span> 
                <span class="keyword">null</span><span class="punctuation">,</span> <span class="string">&#039;utf8&#039;</span><span class="punctuation">)</span>
            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="9362" data-toggle="tooltip" data-title="string">mod</span> <span class="keyword">of</span> <a href="template.html#8941"><span data-toggle="tooltip" data-title="TemplateContext">ctx</span></a><span class="punctuation">.</span><a href="template.html#998"><span data-toggle="tooltip" data-title="string[]">modules</span></a><span class="punctuation">)</span>
                <a href="template.html#586"><span data-toggle="tooltip" data-title="typeof fs">fs</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (fd: number, buffer: NodeJS.ArrayBufferView, offset?: number, length?: number, position?: number): number; (fd: number, string: string, position?: number, encoding?: BufferEncoding): number; }">writeSync</span><span class="punctuation">(</span><a href="template.html#9128"><span data-toggle="tooltip" data-title="number">fd</span></a><span class="punctuation">,</span> <span class="string">`require(&quot;${</span><a href="template.html#9362"><span data-toggle="tooltip" data-title="string">mod</span></a><span class="string">}&quot;);\n`</span><span class="punctuation">,</span> <span class="keyword">null</span><span class="punctuation">,</span> <span class="string">&#039;utf8&#039;</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
        <span class="keyword">finally</span> <span class="punctuation">{</span>
            <a href="template.html#586"><span data-toggle="tooltip" data-title="typeof fs">fs</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(fd: number) =&gt; void">closeSync</span><span class="punctuation">(</span><a href="template.html#9128"><span data-toggle="tooltip" data-title="number">fd</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
    <span class="keyword">return</span> <a href="template.html#8988"><span data-toggle="tooltip" data-title="string">jsPath</span></a>
<span class="punctuation">}</span>
</code></pre>
<h2 id="helper-functions">Helper Functions</h2>
<p>The <code>relLink</code> function returns a relative path from an URL to another.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="9554" class="member" data-toggle="tooltip" data-title="(from: string, to: string) =&gt; string">relLink</span><span class="punctuation">(</span><span id="9694" data-toggle="tooltip" data-title="string">from</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="9707" data-toggle="tooltip" data-title="string">to</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="template.html#9707"><span data-toggle="tooltip" data-title="string">to</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (regexp: string | RegExp): RegExpMatchArray; (matcher: { [Symbol.match](string: string): RegExpMatchArray; }): RegExpMatchArray; }">match</span><span class="punctuation">(</span><span class="string">/^https?:\/\//</span><span class="punctuation">)</span> <span class="punctuation">?</span> <a href="template.html#9707"><span data-toggle="tooltip" data-title="string">to</span></a> <span class="punctuation">:</span>
        <a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(from: string, to: string) =&gt; string">relative</span><span class="punctuation">(</span><a href="template.html#556"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: string) =&gt; string">dirname</span><span class="punctuation">(</span><a href="template.html#9694"><span data-toggle="tooltip" data-title="string">from</span></a><span class="punctuation">)</span><span class="punctuation">,</span> <a href="template.html#9707"><span data-toggle="tooltip" data-title="string">to</span></a><span class="punctuation">)</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (searchValue: string | RegExp, replaceValue: string): string; (searchValue: string | RegExp, replacer: (substring: string, ...args: any[]) =&gt; string): string; (searchValue: { ...; }, replaceValue: string): string; (searchValue: { ...; }, replacer: (substring: string, ...args: any[]) =&gt; string): string; }">replace</span><span class="punctuation">(</span><span class="string">/\\/g</span><span class="punctuation">,</span> <span class="string">&quot;/&quot;</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>

        </div>
            <div class="sidepane narrow-scrollbars">
                
        <div class="pagemenu">
            <h3>On This Page</h3>
                <ul class="pagetree">
                </ul>
        </div>
            </div>
        </div>
        
        <div class="footer">
            <a class="footer-button" href="../server.html">
            <p>Previous</p>
            <p>¬´ Server</p>
        </a>
            <div class="footer-text">
                <p>Copyright ¬© 2023 Tommi Johtela</p>
                <p>Generated by 
                    <a href="https://johtela.github.io/litscript">LiTScript</a>
                </p>
            </div>
            <a class="footer-button" href="html.html">
            <p>Next</p>
            <p>HTML Template Literals ¬ª</p>
        </a>
        </div>
    
        <script src="../../dist/normal.js"></script>

    <script>
      function reloadLink(path) {
        for (const link of document.getElementsByTagName("link")) {
          const url = new URL(link.href)
          if (url.host == location.host && url.pathname == path) {
            const next = link.cloneNode()
            next.href = path + '?' + Math.random().toString(36).slice(2)
            next.onload = () => link.remove()
            link.parentNode.insertBefore(next, link.nextSibling)
            return
          }
        }
      }
      function scriptLoaded(path) {
        for (const script of document.getElementsByTagName("script"))
          if (script.src) {
            const url = new URL(script.src)
            if (url.host == location.host && url.pathname == path)
              return true
          }
        return false
      }
      let ls = new EventSource('/litscript')
      ls.onmessage = e => {
        let updated = JSON.parse(e.data)
        for (let i = 0; i < updated.length; ++i) {
          let path = updated[i]
          if (path.endsWith(".js")) {
            if (scriptLoaded(path))
              return location.reload()
          }
          else if (path.endsWith(".html")) {
            if (path == location.pathname)
              return location.reload()
          }
          else reloadLink(path)
        }
      }
      window.addEventListener("beforeunload", () => ls.close())
    </script>
    </body>
    </html>