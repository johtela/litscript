
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>LiTScript - Main Program</title>
    <link rel="icon" type="image/icon" href="../images/favicon.png" />
    <link rel="stylesheet" href="../css/main.css" />
    
    
</head>
<body>
    
    <div class="navbar">
        <div class="navmenu">
            
    <a class="title enabled" href="../index.html">
        <img src="../images/bulb.svg" />
        <span>LiTScript</span>
    </a>
    <a class="enabled" href="https://www.npmjs.com/package/litscript">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M288 288h-32v-64h32v64zm288-128v192H288v32H160v-32H0V160h576zm-416 32H32v128h64v-96h32v96h32V192zm160 0H192v160h64v-32h64V192zm224 0H352v128h64v-96h32v96h32v-96h32v96h32V192z"/></svg>
        <span>Download</span>
    </a>
    <a class="enabled" href="https://github.com/johtela/litscript">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
        <span>GitHub</span>
    </a>
    <a class="enabled" href="../license.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zM64 72c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8V72zm0 64c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8v-16zm192.81 248H304c8.84 0 16 7.16 16 16s-7.16 16-16 16h-47.19c-16.45 0-31.27-9.14-38.64-23.86-2.95-5.92-8.09-6.52-10.17-6.52s-7.22.59-10.02 6.19l-7.67 15.34a15.986 15.986 0 0 1-14.31 8.84c-.38 0-.75-.02-1.14-.05-6.45-.45-12-4.75-14.03-10.89L144 354.59l-10.61 31.88c-5.89 17.66-22.38 29.53-41 29.53H80c-8.84 0-16-7.16-16-16s7.16-16 16-16h12.39c4.83 0 9.11-3.08 10.64-7.66l18.19-54.64c3.3-9.81 12.44-16.41 22.78-16.41s19.48 6.59 22.77 16.41l13.88 41.64c19.77-16.19 54.05-9.7 66 14.16 2.02 4.06 5.96 6.5 10.16 6.5zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"/></svg>
        <span>License</span>
    </a>
    <a class="enabled" href="bundler.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"/></svg>
        <span>Previous: Bundler</span>
    </a>
    <a class="enabled" href="cli.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34zm192-34l-136-136c-9.4-9.4-24.6-9.4-33.9 0l-22.6 22.6c-9.4 9.4-9.4 24.6 0 33.9l96.4 96.4-96.4 96.4c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l136-136c9.4-9.2 9.4-24.4 0-33.8z"/></svg>
        <span>Next: Command Line Interface</span>
    </a>
        </div>
        
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
    </div>
    
    <div class="layout">
        <div class="sidepane collapsible">
            
    <div class="tocmenu">
        <h3>Table of Contents</h3>
        
    <ul>
        
    <li>
        
        <a href="../index.html"><span data-toggle="tooltip" data-title="Home page">Home</span></a>
        
    </li>
    <li>
        
        <a href="../introduction.html"><span data-toggle="tooltip" data-title="Introduction and Motivation">Introduction</span></a>
        
    </li>
    <li>
        
        <a href="config.html"><span data-toggle="tooltip" data-title="Configuration options and command line parsing">Configuration</span></a>
        
    </li>
    <li>
        
        <a href="region.html"><span data-toggle="tooltip" data-title="Embedding Regions of Code in Markdown">Regions</span></a>
        
    </li>
    <li>
        
        <a href="visualizer.html"><span data-toggle="tooltip" data-title="Adding dynamic content to HTML pages">Visualizers</span></a>
        
    </li>
    <li>
        
        <a href="dependency-graph.html"><span data-toggle="tooltip" data-title="Creating module dependency graph">Dependency Graph</span></a>
        
    </li>
    <li>
        
        <a href="bundler.html"><span data-toggle="tooltip" data-title="Packing JS & CSS files">Bundler</span></a>
        
    </li>
    <li>
        <button class="accordion">
        Implementation
        </button>
            
    <ul>
        
    <li>
        
        <a href="index.html" class="highlight"><span data-toggle="tooltip" data-title="Main program and exports">Main Program</span></a>
        
    </li>
    <li>
        
        <a href="cli.html"><span data-toggle="tooltip" data-title="Scaffolding functionality">Command Line Interface</span></a>
        
    </li>
    <li>
        
        <a href="weaver.html"><span data-toggle="tooltip" data-title="Common code for documentation generation">Weaver</span></a>
        
    </li>
    <li>
        
        <a href="md-weaver.html"><span data-toggle="tooltip" data-title="Markdown generation code">Markdown Weaver</span></a>
        
    </li>
    <li>
        
        <a href="html-weaver.html"><span data-toggle="tooltip" data-title="HTML generation code">HTML Weaver</span></a>
        
    </li>
    <li>
        
        <a href="block-list.html"><span data-toggle="tooltip" data-title="Data structure for code/markdown fragments">Source Blocks</span></a>
        
    </li>
    <li>
        <button class="accordion">
        Translators
        </button>
            
    <ul>
        
    <li>
        
        <a href="translators/translators.html"><span data-toggle="tooltip" data-title="Registering and getting translators">Translating Input Files</span></a>
        
    </li>
    <li>
        
        <a href="translators/base-translator.html"><span data-toggle="tooltip" data-title="Base class and other types related to translators">Translator Base Class</span></a>
        
    </li>
    <li>
        
        <a href="translators/md-translator.html"><span data-toggle="tooltip" data-title="Translator for markdown files">Markdown Translator</span></a>
        
    </li>
    <li>
        
        <a href="translators/ts-translator.html"><span data-toggle="tooltip" data-title="Common code for TypeScript translator">TypeScript Translator</span></a>
        
    </li>
    <li>
        
        <a href="translators/ts-html-translator.html"><span data-toggle="tooltip" data-title="Translating TypeScript to HTML">TypeScript Translator for HTML Output</span></a>
        
    </li>
    <li>
        
        <a href="translators/jsdoc-translator.html">Generic JSDoc Translator</a>
        
    </li>
    </ul>
    </li>
    <li>
        
        <a href="logging.html"><span data-toggle="tooltip" data-title="Outputting errors and progress to console">Logging</span></a>
        
    </li>
    </ul>
    </li>
    <li>
        
        <a href="../license.html"><span data-toggle="tooltip" data-title="License and usage information">License</span></a>
        
    </li>
    </ul>
    </div>
            
        </div>
        <div class="sideicon collapsible">
            
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
        </div>
        <div class="scrollingarea closepopups">
            
    <div class="contentarea">
        <h1 id="main-program">Main Program</h1>
<p>The main module contains the high-level entry points to the project and
exports the public functions and interfaces.</p>
<h2 id="imports">Imports</h2>
<p>First we need to import TypeScript compiler API. It is used to parse and type-check
the TypeScript project we are working on.</p>
<pre class="syntaxhighlight"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="327" data-toggle="tooltip" data-title="typeof ts">ts</span> <span class="keyword">from</span> <span class="string">&#039;typescript&#039;</span>
</code></pre>
<p>We need also <code>path.resolve</code> from Node libraries.</p>
<pre class="syntaxhighlight"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="424" data-toggle="tooltip" data-title="path.PlatformPath">path</span> <span class="keyword">from</span> <span class="string">&#039;path&#039;</span>
</code></pre>
<p>Then we need to import definitions for loading configuration data.</p>
<pre class="syntaxhighlight"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="535" data-toggle="tooltip" data-title="typeof cfg">cfg</span> <span class="keyword">from</span> <span class="string">&#039;./config&#039;</span>
</code></pre>
<p>Weavers that generate the documentation from source files.
We have two variants: one for Markdown and other for HTML output.</p>
<pre class="syntaxhighlight"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="711" data-toggle="tooltip" data-title="typeof mw">mw</span> <span class="keyword">from</span> <span class="string">&#039;./md-weaver&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="746" data-toggle="tooltip" data-title="typeof hw">hw</span> <span class="keyword">from</span> <span class="string">&#039;./html-weaver&#039;</span>
</code></pre>
<p>This module we need for logging errors to console.</p>
<pre class="syntaxhighlight"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="848" data-toggle="tooltip" data-title="typeof log">log</span> <span class="keyword">from</span> <span class="string">&#039;./logging&#039;</span>
<span class="keyword">import</span> <span class="punctuation">{</span> <span id="884" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">finished</span> <span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">&#039;./bundler&#039;</span>
</code></pre>
<h2 id="exports">Exports</h2>
<p>We export configuration and visualizer APIs out from the package.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="punctuation">*</span> <span class="keyword">from</span> <span class="string">&#039;./config&#039;</span>
<span class="keyword">export</span> <span class="punctuation">{</span> <span id="1048" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">finished</span> <span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">&#039;./bundler&#039;</span>
</code></pre>
<h2 id="running-the-tool">Running the Tool</h2>
<p>The <code>run</code> function loads the <code>tsconfig.json</code> file with the TypeScript
API, and starts the compiler in the desired mode. Note that the function
assumes that configuration is already loaded/initialized when it's called.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span id="1076" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">run</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
</code></pre>
<p>First we create the correct weaver based on the configuration.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">let</span> <span id="1475" data-toggle="tooltip" data-title="cfg.Options">opts</span> <span class="punctuation">=</span> <a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#7250"><span class="member" data-toggle="tooltip" data-title="() =&gt; cfg.Options">getOptions</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="1508" data-toggle="tooltip" data-title="mw.MarkdownWeaver | hw.HtmlWeaver">weaver</span> <span class="punctuation">=</span> <a href="index.html#1475"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#2309"><span data-toggle="tooltip" data-title="&quot;markdown&quot; | &quot;html&quot;">outputFormat</span></a> <span class="punctuation">===</span> <span class="string">&#039;markdown&#039;</span> <span class="punctuation">?</span>
        <span class="keyword">new</span> <a href="index.html#711"><span data-toggle="tooltip" data-title="typeof mw">mw</span></a><span class="punctuation">.</span><a href="md-weaver.html#386"><span class="typename" data-toggle="tooltip" data-title="typeof mw.MarkdownWeaver">MarkdownWeaver</span></a><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">:</span>
        <span class="keyword">new</span> <a href="index.html#746"><span data-toggle="tooltip" data-title="typeof hw">hw</span></a><span class="punctuation">.</span><a href="html-weaver.html#2237"><span class="typename" data-toggle="tooltip" data-title="typeof hw.HtmlWeaver">HtmlWeaver</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
</code></pre>
<p>TypeScript compiler can locate the <code>tsconfig.json</code> file for us. If it is
not found, we will throw an error and abort.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">let</span> <span id="1777" data-toggle="tooltip" data-title="string">configPath</span> <span class="punctuation">=</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(searchPath: string, fileExists: (fileName: string) =&gt; boolean, configName?: string) =&gt; string">findConfigFile</span><span class="punctuation">(</span><a href="index.html#1475"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#1709"><span data-toggle="tooltip" data-title="string">baseDir</span></a><span class="punctuation">,</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.System">sys</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: string) =&gt; boolean">fileExists</span><span class="punctuation">,</span>
        <a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#1382"><span data-toggle="tooltip" data-title="&quot;tsconfig.json&quot;">tsconfig</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="index.html#1777"><span data-toggle="tooltip" data-title="string">configPath</span></a><span class="punctuation">)</span>
        <span class="keyword">throw</span> <span class="typename" data-toggle="tooltip" data-title="ErrorConstructor">Error</span><span class="punctuation">(</span><span class="string">`Could not find &#039;${</span><a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#1382"><span data-toggle="tooltip" data-title="&quot;tsconfig.json&quot;">tsconfig</span></a><span class="string">}&#039;.`</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="1953" data-toggle="tooltip" data-title="{ config?: any; error?: ts.Diagnostic; }">configFile</span> <span class="punctuation">=</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(fileName: string, readFile: (path: string) =&gt; string) =&gt; { config?: any; error?: ts.Diagnostic; }">readConfigFile</span><span class="punctuation">(</span><a href="index.html#1777"><span data-toggle="tooltip" data-title="string">configPath</span></a><span class="punctuation">,</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.System">sys</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: string, encoding?: string) =&gt; string">readFile</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="index.html#1953"><span data-toggle="tooltip" data-title="{ config?: any; error?: ts.Diagnostic; }">configFile</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.Diagnostic">error</span><span class="punctuation">)</span>
        <span class="keyword">throw</span> <span class="typename" data-toggle="tooltip" data-title="ErrorConstructor">Error</span><span class="punctuation">(</span><span class="string">`Error parsing &#039;${</span><a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#1382"><span data-toggle="tooltip" data-title="&quot;tsconfig.json&quot;">tsconfig</span></a><span class="string">}&#039;: ${</span><a href="index.html#1953"><span data-toggle="tooltip" data-title="{ config?: any; error?: ts.Diagnostic; }">configFile</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.Diagnostic">error</span><span class="string">}`</span><span class="punctuation">)</span>
</code></pre>
<p>We need a <code>ParseConfigHost</code> object, which is an abstraction layer over
the file system to load and parse the tsconfig file.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">const</span> <span id="2287" data-toggle="tooltip" data-title="ts.ParseConfigHost">parseConfigHost</span><span class="punctuation">:</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="any">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="ts.ParseConfigHost">ParseConfigHost</span> <span class="punctuation">=</span> <span class="punctuation">{</span>
        <span id="2327" data-toggle="tooltip" data-title="(path: string) =&gt; boolean">fileExists</span><span class="punctuation">:</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.System">sys</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: string) =&gt; boolean">fileExists</span><span class="punctuation">,</span>
        <span id="2367" data-toggle="tooltip" data-title="(path: string, encoding?: string) =&gt; string">readFile</span><span class="punctuation">:</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.System">sys</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: string, encoding?: string) =&gt; string">readFile</span><span class="punctuation">,</span>
        <span id="2403" data-toggle="tooltip" data-title="(path: string, extensions?: readonly string[], exclude?: readonly string[], include?: readonly string[], depth?: number) =&gt; string[]">readDirectory</span><span class="punctuation">:</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.System">sys</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: string, extensions?: readonly string[], exclude?: readonly string[], include?: readonly string[], depth?: number) =&gt; string[]">readDirectory</span><span class="punctuation">,</span>
        <span id="2449" data-toggle="tooltip" data-title="true">useCaseSensitiveFileNames</span><span class="punctuation">:</span> <span class="keyword">true</span>
    <span class="punctuation">}</span>
    <span class="keyword">let</span> <span id="2506" data-toggle="tooltip" data-title="ts.ParsedCommandLine">cl</span> <span class="punctuation">=</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(json: any, host: ts.ParseConfigHost, basePath: string, existingOptions?: ts.CompilerOptions, configFileName?: string, resolutionStack?: ts.Path[], extraFileExtensions?: readonly ts.FileExtensionInfo[], extendedConfigCache?: Map&lt;...&gt;, existingWatchOptions?: ts.WatchOptions) =&gt; ts.ParsedCommandLine">parseJsonConfigFileContent</span><span class="punctuation">(</span><a href="index.html#1953"><span data-toggle="tooltip" data-title="{ config?: any; error?: ts.Diagnostic; }">configFile</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="any">config</span><span class="punctuation">,</span> <a href="index.html#2287"><span data-toggle="tooltip" data-title="ts.ParseConfigHost">parseConfigHost</span></a><span class="punctuation">,</span>
        <a href="index.html#424"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...paths: string[]) =&gt; string">resolve</span><span class="punctuation">(</span><a href="index.html#1475"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#1709"><span data-toggle="tooltip" data-title="string">baseDir</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="index.html#2506"><span data-toggle="tooltip" data-title="ts.ParsedCommandLine">cl</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.Diagnostic[]">errors</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">&gt;</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="index.html#848"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#4443"><span class="member" data-toggle="tooltip" data-title="(output: string) =&gt; void">warn</span></a><span class="punctuation">(</span><span class="string">`Error(s) processing options in &#039;${</span><a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#1382"><span data-toggle="tooltip" data-title="&quot;tsconfig.json&quot;">tsconfig</span></a><span class="string">}&#039;:`</span><span class="punctuation">)</span>
        <a href="index.html#2506"><span data-toggle="tooltip" data-title="ts.ParsedCommandLine">cl</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.Diagnostic[]">errors</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(callbackfn: (value: ts.Diagnostic, index: number, array: ts.Diagnostic[]) =&gt; void, thisArg?: any) =&gt; void">forEach</span><span class="punctuation">(</span><a href="index.html#848"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#1108"><span class="member" data-toggle="tooltip" data-title="(diag: ts.Diagnostic) =&gt; void">reportDiagnostic</span></a><span class="punctuation">)</span>
        <span class="keyword">throw</span> <span class="typename" data-toggle="tooltip" data-title="ErrorConstructor">Error</span><span class="punctuation">(</span>`TypeScript compilation failed.`<span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#11883"><span class="member" data-toggle="tooltip" data-title="(opts: ts.CompilerOptions) =&gt; void">setCompilerOptions</span></a><span class="punctuation">(</span><a href="index.html#2506"><span data-toggle="tooltip" data-title="ts.ParsedCommandLine">cl</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.CompilerOptions">options</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="index.html#1475"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5599"><span data-toggle="tooltip" data-title="boolean">watch</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
</code></pre>
<p>When we are in watch mode, we create the watch compiler host,
which automatically wakes up when source files are changed and
calls the weaver to regenerate them.</p>
<pre class="syntaxhighlight"><code>        <span class="keyword">let</span> <span id="3130" data-toggle="tooltip" data-title="ts.WatchCompilerHostOfConfigFile&lt;ts.SemanticDiagnosticsBuilderProgram&gt;">host</span> <span class="punctuation">=</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;T extends ts.BuilderProgram&gt;(configFileName: string, optionsToExtend: ts.CompilerOptions, system: ts.System, createProgram?: ts.CreateProgram&lt;T&gt;, reportDiagnostic?: ts.DiagnosticReporter, reportWatchStatus?: ts.WatchStatusReporter, watchOptionsToExtend?: ts.WatchOptions, extraFileExtensions?: readonly ts.FileExte...">createWatchCompilerHost</span><span class="punctuation">(</span><a href="index.html#1777"><span data-toggle="tooltip" data-title="string">configPath</span></a><span class="punctuation">,</span> <span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">,</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.System">sys</span><span class="punctuation">,</span>
            <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (newProgram: ts.Program, host: ts.BuilderProgramHost, oldProgram?: ts.SemanticDiagnosticsBuilderProgram, configFileParsingDiagnostics?: readonly ts.Diagnostic[]): ts.SemanticDiagnosticsBuilderProgram; (rootNames: readonly string[], options: ts.CompilerOptions, host?: ts.CompilerHost, oldProgram?: ts.SemanticDiagno...">createSemanticDiagnosticsBuilderProgram</span><span class="punctuation">,</span> <a href="index.html#848"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#1108"><span class="member" data-toggle="tooltip" data-title="(diag: ts.Diagnostic) =&gt; void">reportDiagnostic</span></a><span class="punctuation">,</span>
            <a href="index.html#848"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#2498"><span class="member" data-toggle="tooltip" data-title="(diag: ts.Diagnostic) =&gt; void">reportWatchStatusChanged</span></a><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="3323" data-toggle="tooltip" data-title="(program: ts.SemanticDiagnosticsBuilderProgram) =&gt; void">origPostProgramCreate</span> <span class="punctuation">=</span> <a href="index.html#3130"><span data-toggle="tooltip" data-title="ts.WatchCompilerHostOfConfigFile&lt;ts.SemanticDiagnosticsBuilderProgram&gt;">host</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(program: ts.SemanticDiagnosticsBuilderProgram) =&gt; void">afterProgramCreate</span>
        <a href="index.html#3130"><span data-toggle="tooltip" data-title="ts.WatchCompilerHostOfConfigFile&lt;ts.SemanticDiagnosticsBuilderProgram&gt;">host</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(program: ts.SemanticDiagnosticsBuilderProgram) =&gt; void">afterProgramCreate</span> <span class="punctuation">=</span> <span id="3406" data-toggle="tooltip" data-title="ts.SemanticDiagnosticsBuilderProgram">program</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <a href="index.html#1508"><span data-toggle="tooltip" data-title="mw.MarkdownWeaver | hw.HtmlWeaver">weaver</span></a><span class="punctuation">.</span><a href="weaver.html#2193"><span class="member" data-toggle="tooltip" data-title="((prg: ts.SemanticDiagnosticsBuilderProgram) =&gt; void) | ((prg: ts.SemanticDiagnosticsBuilderProgram) =&gt; void)">programChanged</span></a><span class="punctuation">(</span><a href="index.html#3406"><span data-toggle="tooltip" data-title="ts.SemanticDiagnosticsBuilderProgram">program</span></a><span class="punctuation">)</span>
            <a href="index.html#3323"><span data-toggle="tooltip" data-title="(program: ts.SemanticDiagnosticsBuilderProgram) =&gt; void">origPostProgramCreate</span></a><span class="punctuation">(</span><a href="index.html#3406"><span data-toggle="tooltip" data-title="ts.SemanticDiagnosticsBuilderProgram">program</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span>
</code></pre>
<p>Weaver monitors markdown files and recreates the documentation
when they change.</p>
<pre class="syntaxhighlight"><code>        <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;T extends ts.BuilderProgram&gt;(host: ts.WatchCompilerHostOfFilesAndCompilerOptions&lt;T&gt;): ts.WatchOfFilesAndCompilerOptions&lt;T&gt;; &lt;T extends ts.BuilderProgram&gt;(host: ts.WatchCompilerHostOfConfigFile&lt;T&gt;): ts.WatchOfConfigFile&lt;...&gt;; }">createWatchProgram</span><span class="punctuation">(</span><a href="index.html#3130"><span data-toggle="tooltip" data-title="ts.WatchCompilerHostOfConfigFile&lt;ts.SemanticDiagnosticsBuilderProgram&gt;">host</span></a><span class="punctuation">)</span>
        <a href="index.html#1508"><span data-toggle="tooltip" data-title="mw.MarkdownWeaver | hw.HtmlWeaver">weaver</span></a><span class="punctuation">.</span><a href="weaver.html#3123"><span class="member" data-toggle="tooltip" data-title="((host: ts.WatchCompilerHostOfConfigFile&lt;ts.SemanticDiagnosticsBuilderProgram&gt;) =&gt; void) | ((host: ts.WatchCompilerHostOfConfigFile&lt;ts.SemanticDiagnosticsBuilderProgram&gt;) =&gt; void)">watchOtherFiles</span></a><span class="punctuation">(</span><a href="index.html#3130"><span data-toggle="tooltip" data-title="ts.WatchCompilerHostOfConfigFile&lt;ts.SemanticDiagnosticsBuilderProgram&gt;">host</span></a><span class="punctuation">)</span>
</code></pre>
<p>If we are bundling HTML pages, also monitor the template files. Reset
the template, if it changes.</p>
<pre class="syntaxhighlight"><code>        <span class="keyword">if</span> <span class="punctuation">(</span><a href="index.html#1475"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5417"><span data-toggle="tooltip" data-title="boolean">bundle</span></a><span class="punctuation">)</span> 
            <span class="keyword">await</span> <a href="index.html#884"><span data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">finished</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
        <a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#10588"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">watchTemplate</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">else</span> <span class="punctuation">{</span>
</code></pre>
<p>Opening a project in normal mode involves creating a <code>Program</code>
object and checking if the compilation gave any errors. We
generate the documentation once for the whole project and exit.</p>
<pre class="syntaxhighlight"><code>        <span class="keyword">let</span> <span id="4241" data-toggle="tooltip" data-title="ts.Program">prg</span> <span class="punctuation">=</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (createProgramOptions: ts.CreateProgramOptions): ts.Program; (rootNames: readonly string[], options: ts.CompilerOptions, host?: ts.CompilerHost, oldProgram?: ts.Program, configFileParsingDiagnostics?: readonly ts.Diagnostic[]): ts.Program; }">createProgram</span><span class="punctuation">(</span><a href="index.html#2506"><span data-toggle="tooltip" data-title="ts.ParsedCommandLine">cl</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string[]">fileNames</span><span class="punctuation">,</span> <a href="index.html#2506"><span data-toggle="tooltip" data-title="ts.ParsedCommandLine">cl</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.CompilerOptions">options</span><span class="punctuation">)</span>
        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="4308" data-toggle="tooltip" data-title="ts.Diagnostic">diag</span> <span class="keyword">of</span> <a href="index.html#327"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(program: ts.Program, sourceFile?: ts.SourceFile, cancellationToken?: ts.CancellationToken) =&gt; readonly ts.Diagnostic[]">getPreEmitDiagnostics</span><span class="punctuation">(</span><a href="index.html#4241"><span data-toggle="tooltip" data-title="ts.Program">prg</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <a href="index.html#848"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#1108"><span class="member" data-toggle="tooltip" data-title="(diag: ts.Diagnostic) =&gt; void">reportDiagnostic</span></a><span class="punctuation">(</span><a href="index.html#4308"><span data-toggle="tooltip" data-title="ts.Diagnostic">diag</span></a><span class="punctuation">)</span>
        <a href="index.html#1508"><span data-toggle="tooltip" data-title="mw.MarkdownWeaver | hw.HtmlWeaver">weaver</span></a><span class="punctuation">.</span><a href="weaver.html#1187"><span class="member" data-toggle="tooltip" data-title="((prg: ts.Program) =&gt; void) | ((prg: ts.Program) =&gt; void)">generateDocumentation</span></a><span class="punctuation">(</span><a href="index.html#4241"><span data-toggle="tooltip" data-title="ts.Program">prg</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="index.html#1475"><span data-toggle="tooltip" data-title="cfg.Options">opts</span></a><span class="punctuation">.</span><a href="config.html#5417"><span data-toggle="tooltip" data-title="boolean">bundle</span></a><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="index.html#884"><span data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">finished</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
        <span data-toggle="tooltip" data-title="NodeJS.Process">process</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(code?: number) =&gt; never">exit</span><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="command-line-entry-point">Command Line Entry Point</h2>
<p>The main program starts by reading LiTScript options from the
<code>litsconfig.json</code> file and parsing the command line arguments. If any
errors occur during those operations, they are shown on the console, and
processing is aborted. Then the document generation process is kicked off
by calling the <code>run</code> function.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span id="4520" class="member" data-toggle="tooltip" data-title="(args: string[]) =&gt; Promise&lt;void&gt;">main</span><span class="punctuation">(</span><span id="4954" data-toggle="tooltip" data-title="string[]">args</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">try</span> <span class="punctuation">{</span>
        <a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#8071"><span class="member" data-toggle="tooltip" data-title="(baseDir?: string) =&gt; void">readOptionsFromFile</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
        <a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#12535"><span class="member" data-toggle="tooltip" data-title="(args: string[], optObj: object) =&gt; void">parseCommandLine</span></a><span class="punctuation">(</span><a href="index.html#4954"><span data-toggle="tooltip" data-title="string[]">args</span></a><span class="punctuation">,</span> <a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#7250"><span class="member" data-toggle="tooltip" data-title="() =&gt; cfg.Options">getOptions</span></a><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">await</span> <a href="index.html#1076"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">run</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">catch</span> <span class="punctuation">(</span><span id="5112" data-toggle="tooltip" data-title="any">e</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="index.html#848"><span data-toggle="tooltip" data-title="typeof log">log</span></a><span class="punctuation">.</span><a href="logging.html#4193"><span class="member" data-toggle="tooltip" data-title="(err: Error) =&gt; void">error</span></a><span class="punctuation">(</span><a href="index.html#5112"><span data-toggle="tooltip" data-title="any">e</span></a> <span class="keyword">instanceof</span> <span class="typename" data-toggle="tooltip" data-title="ErrorConstructor">Error</span> <span class="punctuation">?</span> <a href="index.html#5112"><span data-toggle="tooltip" data-title="Error">e</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">message</span> <span class="punctuation">:</span> <a href="index.html#5112"><span data-toggle="tooltip" data-title="any">e</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="index.html#5112"><span data-toggle="tooltip" data-title="any">e</span></a> <span class="keyword">instanceof</span> <a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#13905"><span class="typename" data-toggle="tooltip" data-title="typeof cfg.CommandLineError">CommandLineError</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span data-toggle="tooltip" data-title="Console">console</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (...data: any[]): void; (message?: any, ...optionalParams: any[]): void; }">log</span><span class="punctuation">(</span><span class="string">&quot;USAGE: lits &lt;options&gt;\n\nOPTIONS:&quot;</span><span class="punctuation">)</span>
            <a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#13588"><span class="member" data-toggle="tooltip" data-title="(optObj: object) =&gt; void">printCommandLineOptions</span></a><span class="punctuation">(</span><a href="index.html#535"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="config.html#7250"><span class="member" data-toggle="tooltip" data-title="() =&gt; cfg.Options">getOptions</span></a><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
        <span data-toggle="tooltip" data-title="NodeJS.Process">process</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(code?: number) =&gt; never">exit</span><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>

        
    <div class="footer">
        Copyright © 2021 Tommi Johtela
        <div class="ad">
            Created with <a href="https://github.com/johtela/litscript">LiTScript</a>
        </div>
    </div>

    </div>
            <div class="stickypane">
                
    <div class="pagemenu">
        <h3>On This Page</h3>
            <ul class="pagetree">
                
            </ul>
    </div>
                
            </div>
        </div>
    </div>
    <script src="../js/main.js"></script>
    
</body>
</html>