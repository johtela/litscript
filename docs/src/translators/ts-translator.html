
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>
            LiTScript - TypeScript Translator
        </title>
        <link rel="icon" type="image/icon" href="../../images/favicon.png" />
        <link rel="stylesheet" href="../../dist/normal.css" />
        
    </head>
    <body data-syntax-highlight="son-of-obsidian">
        
        <div id="navbar">
            
    <div class="navmenu ">
        
    <div class="navitem " >
        <a class="title enabled" href="../../index.html" >
            <img src="../../images/bulb.svg" />
            <span>LiTScript</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://www.npmjs.com/package/litscript" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-npm" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M1 8h22v7h-12v2h-4v-2h-6z" />
            <path d="M7 8v7" />
            <path d="M14 8v7" />
            <path d="M17 11v4" />
            <path d="M4 11v4" />
            <path d="M11 11v1" />
            <path d="M20 11v4" />
        </svg>
            <span>Download</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://github.com/johtela/litscript" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
        </svg>
            <span>GitHub</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="../../license.html" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-license" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M15 21h-9a3 3 0 0 1 -3 -3v-1h10v2a2 2 0 0 0 4 0v-14a2 2 0 1 1 2 2h-2m2 -4h-11a3 3 0 0 0 -3 3v11" />
            <path d="M9 7l4 0" />
            <path d="M9 11l4 0" />
        </svg>
            <span>License</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a   >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 10l6 6l6 -6h-12" />
        </svg>
            <span>Syntax Highlight</span>
        </a>
        
    <div class="navmenu toggle">
        
    <div class="navitem " id="coding-horror">
        <a   onclick="document.body.syntaxHighlight('coding-horror')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Coding Horror</span>
        </a>
        
    </div>
    <div class="navitem " id="monokai">
        <a   onclick="document.body.syntaxHighlight('monokai')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Monokai</span>
        </a>
        
    </div>
    <div class="navitem " id="solarized-light">
        <a   onclick="document.body.syntaxHighlight('solarized-light')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Solarized Light</span>
        </a>
        
    </div>
    <div class="navitem active" id="son-of-obsidian">
        <a   onclick="document.body.syntaxHighlight('son-of-obsidian')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Son of Obsidian</span>
        </a>
        
    </div>
    </div>
    </div>
    </div>
            
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
        </div>
        
        <div class="layout">
            <div class="sidepane narrow-scrollbars">
                
        <div class="tocmenu">
            <h3>Table of Contents</h3>
            
    <ul>
        
    <li>
        <a href="../../index.html"><span>üè†</span><span data-toggle="tooltip" data-title="Home page">
            Home
        </span></a>
    </li>
    <li>
        <a href="../../introduction.html"><span>ü§ù</span><span data-toggle="tooltip" data-title="Introduction and Motivation">
            Introduction
        </span></a>
    </li>
    <li>
        <a href="../config.html"><span>üéõÔ∏è</span><span data-toggle="tooltip" data-title="Configuration options and command line parsing">
            Configuration
        </span></a>
    </li>
    <li>
        <a href="../templates/toc.html"><span>üìñ</span>Table of Contents</a>
    </li>
    <li>
        <a href="../templates/front-matter.html"><span>üìã</span>Front Matter</a>
    </li>
    <li>
        <a href="../region.html"><span>üåç</span><span data-toggle="tooltip" data-title="Embedding Regions of Code in Markdown">
            Regions
        </span></a>
    </li>
    <li>
        <a href="../dependency-graph.html"><span>üï∏Ô∏è</span><span data-toggle="tooltip" data-title="Creating module dependency graph">
            Dependency Graph
        </span></a>
    </li>
    <li>
        <a href="../bundler.html"><span>üì¶</span><span data-toggle="tooltip" data-title="Packing JS & CSS files">
            Bundler
        </span></a>
    </li>
    <li>
        <a href="../server.html"><span>üì°</span><span data-toggle="tooltip" data-title="Development server setup">
            Server
        </span></a>
    </li>
    <li>
        
    <div class="accordion">
        Site Templates
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="../templates/template.html"><span>üì∞</span><span data-toggle="tooltip" data-title="Creating static web pages">
            Page Templates
        </span></a>
    </li>
    <li>
        <a href="../templates/html.html"><span>üìê</span>HTML Template Literals</a>
    </li>
    <li>
        
    <div class="accordion">
        Default Template
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="../../site/pages/normal/index.html"><span>üêò</span>Normal Page</a>
    </li>
    <li>
        <a href="../../site/styles/theme.html"><span>üé®</span>Theming</a>
    </li>
    </ul>
    </li>
    </ul>
    </li>
    <li>
        
    <div class="accordion">
        Implementation
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="../index.html"><span>üì∫</span><span data-toggle="tooltip" data-title="Main program and exports">
            Main Program
        </span></a>
    </li>
    <li>
        <a href="../cli.html"><span>üêö</span><span data-toggle="tooltip" data-title="Scaffolding functionality">
            Command Line Interface
        </span></a>
    </li>
    <li>
        <a href="../weaver.html"><span>üï∑Ô∏è</span><span data-toggle="tooltip" data-title="Common code for documentation generation">
            Weaver
        </span></a>
    </li>
    <li>
        <a href="../md-weaver.html"><span>‚úçÔ∏è</span><span data-toggle="tooltip" data-title="Markdown generation code">
            Markdown Weaver
        </span></a>
    </li>
    <li>
        <a href="../html-weaver.html"><span>üîó</span><span data-toggle="tooltip" data-title="HTML generation code">
            HTML Weaver
        </span></a>
    </li>
    <li>
        <a href="../block-list.html"><span>üß±</span><span data-toggle="tooltip" data-title="Data structure for code/markdown fragments">
            Source Blocks
        </span></a>
    </li>
    <li>
        
    <div class="accordion">
        Translators
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="translators.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Registering and getting translators">
            Translating Input Files
        </span></a>
    </li>
    <li>
        <a href="base-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Base class and other types related to translators">
            Translator Base Class
        </span></a>
    </li>
    <li>
        <a href="md-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Translator for markdown files">
            Markdown Translator
        </span></a>
    </li>
    <li>
        <a href="ts-translator.html" class="highlight"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Common code for TypeScript translator">
            TypeScript Translator
        </span></a>
    </li>
    <li>
        <a href="ts-html-translator.html"><span>üó£Ô∏è</span><span data-toggle="tooltip" data-title="Translating TypeScript to HTML">
            TypeScript Translator for HTML Output
        </span></a>
    </li>
    <li>
        <a href="jsdoc-translator.html"><span>üó£Ô∏è</span>Generic JSDoc Translator</a>
    </li>
    </ul>
    </li>
    <li>
        <a href="../utils.html"><span>üõ†Ô∏è</span><span data-toggle="tooltip" data-title="File path & directory utilities">
            Utilities
        </span></a>
    </li>
    <li>
        <a href="../logging.html"><span>üìí</span><span data-toggle="tooltip" data-title="Outputting errors and progress to console">
            Logging
        </span></a>
    </li>
    </ul>
    </li>
    <li>
        <a href="../../license.html"><span>üìú</span><span data-toggle="tooltip" data-title="License and usage information">
            License
        </span></a>
    </li>
    </ul>
        </div>
                <div class="toc-button"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-right" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M7 7l5 5l-5 5" />
            <path d="M13 7l5 5l-5 5" />
        </svg></div>
            </div>
            
        <div class="contentarea closepopups">
            <h1 id="translating-type-script-files">Translating TypeScript Files</h1>
<p>This module contains common code  needed for translating TypeScript files
into block lists. It works as a stand-alone translator for markdown output,
and as a base class for translator used in context of HTML output.</p>
<details>
<summary>ts-translator imports</summary>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="323" data-toggle="tooltip" data-title="path.PlatformPath">path</span> <span class="keyword">from</span> <span class="string">&#039;path&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="353" data-toggle="tooltip" data-title="typeof ts">ts</span> <span class="keyword">from</span> <span class="string">&#039;typescript&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="387" data-toggle="tooltip" data-title="typeof bl">bl</span> <span class="keyword">from</span> <span class="string">&#039;../block-list&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="424" data-toggle="tooltip" data-title="typeof bt">bt</span> <span class="keyword">from</span> <span class="string">&#039;./base-translator&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="465" data-toggle="tooltip" data-title="typeof reg">reg</span> <span class="keyword">from</span> <span class="string">&#039;../region&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="499" data-toggle="tooltip" data-title="typeof dg">dg</span> <span class="keyword">from</span> <span class="string">&#039;../dependency-graph&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="542" data-toggle="tooltip" data-title="typeof cfg">cfg</span> <span class="keyword">from</span> <span class="string">&#039;../config&#039;</span>
</code></pre>
</details>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">class</span> <span id="568" class="typename" data-toggle="tooltip" data-title="TsTranslator">TsTranslator</span> <span class="keyword">extends</span> <a href="ts-translator.html#424"><span data-toggle="tooltip" data-title="typeof bt">bt</span></a><span class="punctuation">.</span><a href="base-translator.html#1293"><span class="typename" data-toggle="tooltip" data-title="typeof bt.Translator">Translator</span></a> <span class="punctuation">{</span>
</code></pre>
<p>Regions can be nested, thus, a stack of open regions is maintained in an
array.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span class="keyword">private</span> <span id="635" data-toggle="tooltip" data-title="reg.Region[]">regions</span><span class="punctuation">:</span> <a href="ts-translator.html#465"><span data-toggle="tooltip" data-title="any">reg</span></a><span class="punctuation">.</span><a href="../region.html#1983"><span class="typename" data-toggle="tooltip" data-title="reg.Region">Region</span></a><span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<h2 id="processing-source-files">Processing Source Files</h2>
<p>TypeScript files are processed by traversing the leafs of the
<em>abstract syntax tree</em> (AST) in order. We are deliberately skipping the
nonterminals because we only want to output the source fragments.
TypeScript compiler provides us the JSDoc comments already concatenated
and cleaned up. This saves us from the work of parsing them.</p>
<p>However, we still need to check the <em>trivia</em> fragments ignored by the
TypeScript parser, because they contain normal comments and processing
instructions which we want to show and process. To do this, we maintain
a position in the source file in the <code>prevEnd</code> variable. The variable
contains the ending position of the previous AST node. If the current
node lies on a further position, we know that there is some trivia in
between that we need to parse.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span class="keyword">protected</span> <span id="785" class="member" data-toggle="tooltip" data-title="() =&gt; void">createBlocks</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#635"><span data-toggle="tooltip" data-title="reg.Region[]">regions</span></a> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
        <span class="keyword">let</span> <span id="1814" data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span> <span class="punctuation">=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#1505"><span data-toggle="tooltip" data-title="bt.OutputFile">outputFile</span></a><span class="punctuation">.</span><a href="base-translator.html#1008"><span data-toggle="tooltip" data-title="bt.OtherFile | ts.SourceFile">source</span></a> <span class="keyword">as</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="any">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="ts.SourceFile">SourceFile</span>
        <span class="keyword">let</span> <span id="1877" data-toggle="tooltip" data-title="dg.Module">module</span> <span class="punctuation">=</span> <a href="ts-translator.html#499"><span data-toggle="tooltip" data-title="typeof dg">dg</span></a><span class="punctuation">.</span><a href="../dependency-graph.html#2278"><span class="member" data-toggle="tooltip" data-title="(name: string, url?: string) =&gt; dg.Module">addModule</span></a><span class="punctuation">(</span><a href="ts-translator.html#542"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="../config.html#7855"><span class="member" data-toggle="tooltip" data-title="(filePath: string) =&gt; string">getBaseRelativePath</span></a><span class="punctuation">(</span><a href="ts-translator.html#1814"><span data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">fileName</span><span class="punctuation">)</span><span class="punctuation">,</span>
            <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#1505"><span data-toggle="tooltip" data-title="bt.OutputFile">outputFile</span></a><span class="punctuation">.</span><a href="base-translator.html#1075"><span data-toggle="tooltip" data-title="string">relTargetPath</span></a><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="1999" data-toggle="tooltip" data-title="string">src</span> <span class="punctuation">=</span> <a href="ts-translator.html#1814"><span data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(sourceFile?: ts.SourceFile) =&gt; string">getFullText</span><span class="punctuation">(</span><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="2040" data-toggle="tooltip" data-title="number">prevEnd</span> <span class="punctuation">=</span> <span class="number">0</span>
        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">const</span> <span id="2072" data-toggle="tooltip" data-title="ts.Node">node</span> <span class="keyword">of</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#3807"><span class="member" data-toggle="tooltip" data-title="(root: ts.Node) =&gt; Iterable&lt;ts.Node&gt;">iterateAst</span></a><span class="punctuation">(</span><a href="ts-translator.html#1814"><span data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="2125" data-toggle="tooltip" data-title="number">start</span> <span class="punctuation">=</span> <a href="ts-translator.html#2072"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(sourceFile?: ts.SourceFile, includeJsDocComment?: boolean) =&gt; number">getStart</span><span class="punctuation">(</span><a href="ts-translator.html#1814"><span data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span></a><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#2125"><span data-toggle="tooltip" data-title="number">start</span></a> <span class="punctuation">&gt;</span> <a href="ts-translator.html#2040"><span data-toggle="tooltip" data-title="number">prevEnd</span></a><span class="punctuation">)</span>
                <span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#4859"><span class="member" data-toggle="tooltip" data-title="(text: string) =&gt; void">parseTrivia</span></a><span class="punctuation">(</span><a href="ts-translator.html#1999"><span data-toggle="tooltip" data-title="string">src</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start?: number, end?: number) =&gt; string">slice</span><span class="punctuation">(</span><a href="ts-translator.html#2040"><span data-toggle="tooltip" data-title="number">prevEnd</span></a><span class="punctuation">,</span> <a href="ts-translator.html#2125"><span data-toggle="tooltip" data-title="number">start</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(node: ts.Node) =&gt; node is ts.JSDoc">isJSDoc</span><span class="punctuation">(</span><a href="ts-translator.html#2072"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="keyword">let</span> <span id="2309" data-toggle="tooltip" data-title="string">inner</span> <span class="punctuation">=</span> <span class="punctuation">&lt;</span><span class="keyword">string</span><span class="punctuation">&gt;</span><span class="punctuation">(</span><span class="punctuation">&lt;</span><a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="any">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="ts.JSDoc">JSDoc</span><span class="punctuation">&gt;</span><a href="ts-translator.html#2072"><span data-toggle="tooltip" data-title="ts.JSDoc">node</span></a><span class="punctuation">)</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string | ts.NodeArray&lt;ts.JSDocComment&gt;">comment</span>
                <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#3140"><span class="member" data-toggle="tooltip" data-title="(text: string, fileName: string) =&gt; void">splitMdFile</span></a><span class="punctuation">(</span><a href="ts-translator.html#2309"><span data-toggle="tooltip" data-title="string">inner</span></a><span class="punctuation">,</span> <a href="ts-translator.html#1814"><span data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">fileName</span><span class="punctuation">)</span>
            <span class="punctuation">}</span>
            <span class="keyword">else</span> <span class="punctuation">{</span>
                <span class="keyword">let</span> <span id="2465" data-toggle="tooltip" data-title="string">text</span> <span class="punctuation">=</span> <a href="ts-translator.html#2072"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(sourceFile?: ts.SourceFile) =&gt; string">getText</span><span class="punctuation">(</span><a href="ts-translator.html#1814"><span data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span></a><span class="punctuation">)</span>
                <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#7127"><span class="member" data-toggle="tooltip" data-title="(node: ts.Node, text: string) =&gt; void">appendCode</span></a><span class="punctuation">(</span><a href="ts-translator.html#2072"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">,</span> <a href="ts-translator.html#2465"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">)</span>
                <span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#2667"><span class="member" data-toggle="tooltip" data-title="(module: dg.Module, node: ts.Node, text: string) =&gt; void">checkDependency</span></a><span class="punctuation">(</span><a href="ts-translator.html#1877"><span data-toggle="tooltip" data-title="dg.Module">module</span></a><span class="punctuation">,</span> <a href="ts-translator.html#2072"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">,</span> <a href="ts-translator.html#2465"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">)</span>
            <span class="punctuation">}</span>
            <a href="ts-translator.html#2040"><span data-toggle="tooltip" data-title="number">prevEnd</span></a> <span class="punctuation">=</span> <a href="ts-translator.html#2072"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; number">getEnd</span><span class="punctuation">(</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
</code></pre>
<h2 id="updating-dependency-graph">Updating Dependency Graph</h2>
<p>While traversing the AST, we check if we encounter import or export
statements. When we do, we add a dependendency to the graph. We need to
normalize the name of the imported module, so we remove the quotes from
it and make its path relative to the base directory.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span class="keyword">private</span> <span id="2667" class="member" data-toggle="tooltip" data-title="(module: dg.Module, node: ts.Node, text: string) =&gt; void">checkDependency</span><span class="punctuation">(</span><span id="3061" data-toggle="tooltip" data-title="dg.Module">module</span><span class="punctuation">:</span> <a href="ts-translator.html#499"><span data-toggle="tooltip" data-title="any">dg</span></a><span class="punctuation">.</span><a href="../dependency-graph.html#0"><span class="typename" data-toggle="tooltip" data-title="dg.Module">Module</span></a><span class="punctuation">,</span> <span id="3079" data-toggle="tooltip" data-title="ts.Node">node</span><span class="punctuation">:</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="any">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="ts.Node">Node</span><span class="punctuation">,</span> <span id="3094" data-toggle="tooltip" data-title="string">text</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#3079"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.SyntaxKind">kind</span> <span class="punctuation">==</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof ts.SyntaxKind">SyntaxKind</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.SyntaxKind.StringLiteral">StringLiteral</span> <span class="punctuation">&amp;&amp;</span> <a href="ts-translator.html#3079"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.Node">parent</span> <span class="punctuation">&amp;&amp;</span>
            <span class="punctuation">(</span><a href="ts-translator.html#3079"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.Node">parent</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.SyntaxKind">kind</span> <span class="punctuation">==</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof ts.SyntaxKind">SyntaxKind</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.SyntaxKind.ImportDeclaration">ImportDeclaration</span> <span class="punctuation">||</span> 
            <a href="ts-translator.html#3079"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.Node">parent</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.SyntaxKind.Unknown | ts.SyntaxKind.EndOfFileToken | ts.SyntaxKind.SingleLineCommentTrivia | ts.SyntaxKind.MultiLineCommentTrivia | ts.SyntaxKind.NewLineTrivia | ts.SyntaxKind.WhitespaceTrivia | ts.SyntaxKind.ShebangTrivia | ts.SyntaxKind.ConflictMarkerTrivia | ts.SyntaxKind.NonTextFileMarkerTrivia | ... 352 more ...">kind</span> <span class="punctuation">==</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof ts.SyntaxKind">SyntaxKind</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="ts.SyntaxKind.ExportDeclaration">ExportDeclaration</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="3338" data-toggle="tooltip" data-title="string">fileName</span> <span class="punctuation">=</span> <a href="ts-translator.html#3094"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (searchValue: string | RegExp, replaceValue: string): string; (searchValue: string | RegExp, replacer: (substring: string, ...args: any[]) =&gt; string): string; (searchValue: { ...; }, replaceValue: string): string; (searchValue: { ...; }, replacer: (substring: string, ...args: any[]) =&gt; string): string; }">replace</span><span class="punctuation">(</span><span class="string">/[&#039;&quot;]+/g</span><span class="punctuation">,</span> <span class="string">&#039;&#039;</span><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">[</span><span class="string">&quot;.&quot;</span><span class="punctuation">,</span> <span class="string">&quot;..&quot;</span><span class="punctuation">]</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(searchElement: string, fromIndex?: number) =&gt; boolean">includes</span><span class="punctuation">(</span><a href="ts-translator.html#323"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: string, suffix?: string) =&gt; string">basename</span><span class="punctuation">(</span><a href="ts-translator.html#3338"><span data-toggle="tooltip" data-title="string">fileName</span></a><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>
                <a href="ts-translator.html#3338"><span data-toggle="tooltip" data-title="string">fileName</span></a> <span class="punctuation">+=</span> <span class="string">&quot;/index&quot;</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#3338"><span data-toggle="tooltip" data-title="string">fileName</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">==</span> <span class="string">&#039;.&#039;</span> <span class="punctuation">||</span> <a href="ts-translator.html#3338"><span data-toggle="tooltip" data-title="string">fileName</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">==</span> <span class="string">&#039;/&#039;</span> <span class="punctuation">||</span> <a href="ts-translator.html#3338"><span data-toggle="tooltip" data-title="string">fileName</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">==</span> <span class="string">&#039;\\&#039;</span><span class="punctuation">)</span>
                <a href="ts-translator.html#3338"><span data-toggle="tooltip" data-title="string">fileName</span></a> <span class="punctuation">=</span> <a href="ts-translator.html#542"><span data-toggle="tooltip" data-title="typeof cfg">cfg</span></a><span class="punctuation">.</span><a href="../config.html#7855"><span class="member" data-toggle="tooltip" data-title="(filePath: string) =&gt; string">getBaseRelativePath</span></a><span class="punctuation">(</span><a href="ts-translator.html#323"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...paths: string[]) =&gt; string">resolve</span><span class="punctuation">(</span>
                    <a href="ts-translator.html#323"><span data-toggle="tooltip" data-title="path.PlatformPath">path</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(path: string) =&gt; string">dirname</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#1505"><span data-toggle="tooltip" data-title="bt.OutputFile">outputFile</span></a><span class="punctuation">.</span><a href="base-translator.html#1008"><span data-toggle="tooltip" data-title="bt.OtherFile | ts.SourceFile">source</span></a><span class="punctuation">.</span><a href="base-translator.html#656"><span data-toggle="tooltip" data-title="string">fileName</span></a><span class="punctuation">)</span><span class="punctuation">,</span> <a href="ts-translator.html#3338"><span data-toggle="tooltip" data-title="string">fileName</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <a href="ts-translator.html#499"><span data-toggle="tooltip" data-title="typeof dg">dg</span></a><span class="punctuation">.</span><a href="../dependency-graph.html#2278"><span class="member" data-toggle="tooltip" data-title="(name: string, url?: string) =&gt; dg.Module">addModule</span></a><span class="punctuation">(</span><a href="ts-translator.html#3338"><span data-toggle="tooltip" data-title="string">fileName</span></a><span class="punctuation">)</span>
            <a href="ts-translator.html#499"><span data-toggle="tooltip" data-title="typeof dg">dg</span></a><span class="punctuation">.</span><a href="../dependency-graph.html#2754"><span class="member" data-toggle="tooltip" data-title="(module: dg.Module, dependency: string) =&gt; void">addDependency</span></a><span class="punctuation">(</span><a href="ts-translator.html#3061"><span data-toggle="tooltip" data-title="dg.Module">module</span></a><span class="punctuation">,</span> <a href="ts-translator.html#3338"><span data-toggle="tooltip" data-title="string">fileName</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
</code></pre>
<h2 id="iterating-the-ast">Iterating the AST</h2>
<p>AST iteration is implemented as a recursive <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators">generator</a>. It traverses
the tree in post-order (children are processed before their parents) and
checks for each node, if it is of a correct type. Iteration only returns
JSDoc nodes, tokens, and identifiers, i.e. the nonterminals of the
abstract syntax tree.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span class="keyword">private</span> <span class="punctuation">*</span><span id="3807" class="member" data-toggle="tooltip" data-title="(root: ts.Node) =&gt; Iterable&lt;ts.Node&gt;">iterateAst</span><span class="punctuation">(</span><span id="4353" data-toggle="tooltip" data-title="ts.Node">root</span><span class="punctuation">:</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="any">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="ts.Node">Node</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Iterable&lt;T&gt;">Iterable</span><span class="punctuation">&lt;</span><a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="any">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="ts.Node">Node</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
        <span class="keyword">function</span> <span id="4388" class="member" data-toggle="tooltip" data-title="(node: ts.Node) =&gt; boolean">validNode</span><span class="punctuation">(</span><span id="4417" data-toggle="tooltip" data-title="ts.Node">node</span><span class="punctuation">:</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="any">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="ts.Node">Node</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">return</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(node: ts.Node) =&gt; node is ts.JSDoc">isJSDoc</span><span class="punctuation">(</span><a href="ts-translator.html#4417"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">)</span> <span class="punctuation">||</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(n: ts.Node) =&gt; boolean">isToken</span><span class="punctuation">(</span><a href="ts-translator.html#4417"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">)</span> <span class="punctuation">||</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="typeof ts">ts</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(node: ts.Node) =&gt; node is ts.Identifier">isIdentifier</span><span class="punctuation">(</span><a href="ts-translator.html#4417"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span>
        <span class="keyword">let</span> <span id="4539" data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span> <span class="punctuation">=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#1505"><span data-toggle="tooltip" data-title="bt.OutputFile">outputFile</span></a><span class="punctuation">.</span><a href="base-translator.html#1008"><span data-toggle="tooltip" data-title="bt.OtherFile | ts.SourceFile">source</span></a> <span class="keyword">as</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="any">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="ts.SourceFile">SourceFile</span>
        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="4607" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <span class="number">0</span><span class="punctuation">;</span> <a href="ts-translator.html#4607"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;</span> <a href="ts-translator.html#4353"><span data-toggle="tooltip" data-title="ts.Node">root</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(sourceFile?: ts.SourceFile) =&gt; number">getChildCount</span><span class="punctuation">(</span><a href="ts-translator.html#4539"><span data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span></a><span class="punctuation">)</span><span class="punctuation">;</span> <span class="punctuation">++</span><a href="ts-translator.html#4607"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">)</span>
            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="4674" data-toggle="tooltip" data-title="ts.Node">node</span> <span class="keyword">of</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#3807"><span class="member" data-toggle="tooltip" data-title="(root: ts.Node) =&gt; Iterable&lt;ts.Node&gt;">iterateAst</span></a><span class="punctuation">(</span><a href="ts-translator.html#4353"><span data-toggle="tooltip" data-title="ts.Node">root</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(index: number, sourceFile?: ts.SourceFile) =&gt; ts.Node">getChildAt</span><span class="punctuation">(</span><a href="ts-translator.html#4607"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">,</span> <a href="ts-translator.html#4539"><span data-toggle="tooltip" data-title="ts.SourceFile">srcFile</span></a><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>
                <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#4388"><span class="member" data-toggle="tooltip" data-title="(node: ts.Node) =&gt; boolean">validNode</span></a><span class="punctuation">(</span><a href="ts-translator.html#4674"><span data-toggle="tooltip" data-title="ts.Node">node</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
                    <span class="keyword">yield</span> <a href="ts-translator.html#4674"><span data-toggle="tooltip" data-title="ts.Node">node</span></a>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#4388"><span class="member" data-toggle="tooltip" data-title="(node: ts.Node) =&gt; boolean">validNode</span></a><span class="punctuation">(</span><a href="ts-translator.html#4353"><span data-toggle="tooltip" data-title="ts.Node">root</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="keyword">yield</span> <a href="ts-translator.html#4353"><span data-toggle="tooltip" data-title="ts.Node">root</span></a>
    <span class="punctuation">}</span>
</code></pre>
<h2 id="parsing-trivia">Parsing Trivia</h2>
<p>Whitespace, comments and directives that are not included in the AST
are called <em>trivia</em>. The method below gets a piece of trivia (no pun
intended) and runs a regex to extract comments from it. If it finds
a &quot;normal&quot; single-line or multi-line comment, it outputs it as code.
The method has to be quite careful to preserve the whitespace in the
code and output the text not inside comments as-is.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span class="keyword">private</span> <span id="4859" class="member" data-toggle="tooltip" data-title="(text: string) =&gt; void">parseTrivia</span><span class="punctuation">(</span><span id="5384" data-toggle="tooltip" data-title="string">text</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#5498"><span class="member" data-toggle="tooltip" data-title="(kind: bl.BlockKind) =&gt; void">ensureBlock</span></a><span class="punctuation">(</span><a href="ts-translator.html#387"><span data-toggle="tooltip" data-title="typeof bl">bl</span></a><span class="punctuation">.</span><a href="../block-list.html#0"><span class="typename" data-toggle="tooltip" data-title="typeof bl.BlockKind">BlockKind</span></a><span class="punctuation">.</span><a href="../block-list.html#285"><span data-toggle="tooltip" data-title="bl.BlockKind.code">code</span></a><span class="punctuation">)</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#5890"><span class="member" data-toggle="tooltip" data-title="(text: string, regex: RegExp, matchFn: (matches: RegExpExecArray) =&gt; void, gapFn: (gap: string) =&gt; void) =&gt; void">scan</span></a><span class="punctuation">(</span><a href="ts-translator.html#5384"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">,</span> <span class="string">/(\/\/([^\r\n]*))|(\/\*(.*)\*\/)/gs</span><span class="punctuation">,</span>
            <span id="5506" data-toggle="tooltip" data-title="RegExpExecArray">match</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
                <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#5506"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#5871"><span class="member" data-toggle="tooltip" data-title="(inner: string) =&gt; boolean">isRegionMarker</span></a><span class="punctuation">(</span><a href="ts-translator.html#5506"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span>
                        <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#7275"><span class="member" data-toggle="tooltip" data-title="(text: string, inner: string) =&gt; void">appendSingleLineComment</span></a><span class="punctuation">(</span><a href="ts-translator.html#5506"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <a href="ts-translator.html#5506"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span>
                <span class="punctuation">}</span>
                <span class="keyword">else</span>
                    <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#7436"><span class="member" data-toggle="tooltip" data-title="(text: string, inner: string) =&gt; void">appendMultiLineComment</span></a><span class="punctuation">(</span><a href="ts-translator.html#5506"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> <a href="ts-translator.html#5506"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">)</span>
            <span class="punctuation">}</span><span class="punctuation">,</span>
            <span id="5820" data-toggle="tooltip" data-title="string">t</span> <span class="punctuation">=&gt;</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#1646"><span data-toggle="tooltip" data-title="bl.BlockList">currBlock</span></a><span class="punctuation">.</span><a href="../block-list.html#2308"><span class="member" data-toggle="tooltip" data-title="(text: string) =&gt; void">append</span></a><span class="punctuation">(</span><a href="ts-translator.html#5820"><span data-toggle="tooltip" data-title="string">t</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
</code></pre>
<h2 id="creating-regions">Creating Regions</h2>
<p>The <code>isRegionMarker</code> method checks if a single line comment contains
a <code>#region</code> or <code>#endregion</code> directive and opens or closes a region if it
finds either. It returns true, if a region directive was found.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span class="keyword">private</span> <span id="5871" class="member" data-toggle="tooltip" data-title="(inner: string) =&gt; boolean">isRegionMarker</span><span class="punctuation">(</span><span id="6187" data-toggle="tooltip" data-title="string">inner</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">boolean</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="6225" data-toggle="tooltip" data-title="RegExp">startRegionRE</span> <span class="punctuation">=</span> <span class="string">/^\s*#region\s+(-h|-c)?(.*)$/</span>
        <span class="keyword">let</span> <span id="6284" data-toggle="tooltip" data-title="RegExp">endRegionRE</span> <span class="punctuation">=</span> <span class="string">/^\s*#endregion($|\s)/</span>
        <span class="keyword">let</span> <span id="6334" data-toggle="tooltip" data-title="RegExpExecArray">mt</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExpExecArray">RegExpExecArray</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#6334"><span data-toggle="tooltip" data-title="RegExpExecArray">mt</span></a> <span class="punctuation">=</span> <a href="ts-translator.html#6225"><span data-toggle="tooltip" data-title="RegExp">startRegionRE</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray">exec</span><span class="punctuation">(</span><a href="ts-translator.html#6187"><span data-toggle="tooltip" data-title="string">inner</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#6634"><span class="member" data-toggle="tooltip" data-title="(flags: string, regionName: string) =&gt; void">openRegion</span></a><span class="punctuation">(</span><a href="ts-translator.html#6334"><span data-toggle="tooltip" data-title="RegExpExecArray">mt</span></a><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <a href="ts-translator.html#6334"><span data-toggle="tooltip" data-title="RegExpExecArray">mt</span></a><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">trim</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="keyword">return</span> <span class="keyword">true</span>
        <span class="punctuation">}</span>
        <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#6334"><span data-toggle="tooltip" data-title="RegExpExecArray">mt</span></a> <span class="punctuation">=</span> <a href="ts-translator.html#6284"><span data-toggle="tooltip" data-title="RegExp">endRegionRE</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray">exec</span><span class="punctuation">(</span><a href="ts-translator.html#6187"><span data-toggle="tooltip" data-title="string">inner</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#8165"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">closeRegion</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
            <span class="keyword">return</span> <span class="keyword">true</span>
        <span class="punctuation">}</span>
        <span class="keyword">return</span> <span class="keyword">false</span>
    <span class="punctuation">}</span>
</code></pre>
<p>A region can have an additional flag which controls whether it is
included in the output or not. There are three options:</p>
<ol>
<li>With no flags the text and code inside the region is shown
normally in the output.</li>
<li>With the <code>-c</code> flag the region is collapsed by default. This is
implemented using a <code>&lt;details&gt;</code> tag. This is of course a HTML
feature, but it works also on GitHub wiki. So, it is implemented
here and not in the <a href="ts-html-translator.html">TsHtmlTranslator</a> subclass.</li>
<li>A region with the <code>-h</code> flag is hidden in output. This is also
implemented as HTML using comment tags, so it works with markdown
wikis.</li>
</ol>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span class="keyword">private</span> <span id="6634" class="member" data-toggle="tooltip" data-title="(flags: string, regionName: string) =&gt; void">openRegion</span><span class="punctuation">(</span><span id="7465" data-toggle="tooltip" data-title="string">flags</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="7479" data-toggle="tooltip" data-title="string">regionName</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="7514" data-toggle="tooltip" data-title="reg.Visibility">vis</span> <span class="punctuation">=</span> <a href="ts-translator.html#465"><span data-toggle="tooltip" data-title="typeof reg">reg</span></a><span class="punctuation">.</span><a href="../region.html#1434"><span class="typename" data-toggle="tooltip" data-title="typeof reg.Visibility">Visibility</span></a><span class="punctuation">.</span><a href="../region.html#1954"><span data-toggle="tooltip" data-title="reg.Visibility.Visible">Visible</span></a>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#7465"><span data-toggle="tooltip" data-title="string">flags</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#7465"><span data-toggle="tooltip" data-title="string">flags</span></a><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">==</span> <span class="string">&#039;c&#039;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#6736"><span class="member" data-toggle="tooltip" data-title="(text: string) =&gt; void">appendMarkdown</span></a><span class="punctuation">(</span><span class="string">`\n\n&lt;details&gt;\n&lt;summary&gt;${</span><a href="ts-translator.html#7479"><span data-toggle="tooltip" data-title="string">regionName</span></a> <span class="punctuation">||</span>
                    <span class="string">&quot;Click to show / hide...&quot;</span><span class="string">}&lt;/summary&gt;\n\n`</span><span class="punctuation">)</span>
                <a href="ts-translator.html#7514"><span data-toggle="tooltip" data-title="reg.Visibility">vis</span></a> <span class="punctuation">=</span> <a href="ts-translator.html#465"><span data-toggle="tooltip" data-title="typeof reg">reg</span></a><span class="punctuation">.</span><a href="../region.html#1434"><span class="typename" data-toggle="tooltip" data-title="typeof reg.Visibility">Visibility</span></a><span class="punctuation">.</span><a href="../region.html#1971"><span data-toggle="tooltip" data-title="reg.Visibility.Collapsed">Collapsed</span></a>
            <span class="punctuation">}</span>
            <span class="keyword">else</span> <span class="punctuation">{</span>
                <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#6736"><span class="member" data-toggle="tooltip" data-title="(text: string) =&gt; void">appendMarkdown</span></a><span class="punctuation">(</span><span class="string">&#039;\n&lt;!--\n\n&#039;</span><span class="punctuation">)</span>
                <a href="ts-translator.html#7514"><span data-toggle="tooltip" data-title="reg.Visibility">vis</span></a> <span class="punctuation">=</span> <a href="ts-translator.html#465"><span data-toggle="tooltip" data-title="typeof reg">reg</span></a><span class="punctuation">.</span><a href="../region.html#1434"><span class="typename" data-toggle="tooltip" data-title="typeof reg.Visibility">Visibility</span></a><span class="punctuation">.</span><a href="../region.html#1963"><span data-toggle="tooltip" data-title="reg.Visibility.Hidden">Hidden</span></a>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#5199"><span class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; void">openCodeBlock</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="7991" data-toggle="tooltip" data-title="bt.OutputFile">of</span> <span class="punctuation">=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#1505"><span data-toggle="tooltip" data-title="bt.OutputFile">outputFile</span></a>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#635"><span data-toggle="tooltip" data-title="reg.Region[]">regions</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: reg.Region[]) =&gt; number">push</span><span class="punctuation">(</span><a href="ts-translator.html#465"><span data-toggle="tooltip" data-title="typeof reg">reg</span></a><span class="punctuation">.</span><a href="../region.html#1983"><span class="typename" data-toggle="tooltip" data-title="typeof reg.Region">Region</span></a><span class="punctuation">.</span><a href="../region.html#4071"><span class="member" data-toggle="tooltip" data-title="(name: string, start: bl.BlockList, definedInFile: string, relOutputFile: string, mode: reg.Visibility) =&gt; reg.Region">add</span></a><span class="punctuation">(</span><a href="ts-translator.html#7479"><span data-toggle="tooltip" data-title="string">regionName</span></a><span class="punctuation">,</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#1646"><span data-toggle="tooltip" data-title="bl.BlockList">currBlock</span></a><span class="punctuation">,</span>
            <span class="punctuation">(</span><a href="ts-translator.html#7991"><span data-toggle="tooltip" data-title="bt.OutputFile">of</span></a><span class="punctuation">.</span><a href="base-translator.html#1008"><span data-toggle="tooltip" data-title="bt.OtherFile | ts.SourceFile">source</span></a> <span class="keyword">as</span> <a href="ts-translator.html#353"><span data-toggle="tooltip" data-title="any">ts</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="ts.SourceFile">SourceFile</span><span class="punctuation">)</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">fileName</span><span class="punctuation">,</span> <a href="ts-translator.html#7991"><span data-toggle="tooltip" data-title="bt.OutputFile">of</span></a><span class="punctuation">.</span><a href="base-translator.html#1075"><span data-toggle="tooltip" data-title="string">relTargetPath</span></a><span class="punctuation">,</span> <a href="ts-translator.html#7514"><span data-toggle="tooltip" data-title="reg.Visibility">vis</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
</code></pre>
<p>When a region is closed we pop it from the stack and append the
appropriate closing tag to the output, if the region is collapsed or
hidden.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span class="keyword">private</span> <span id="8165" class="member" data-toggle="tooltip" data-title="() =&gt; void">closeRegion</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="8391" data-toggle="tooltip" data-title="reg.Region">region</span> <span class="punctuation">=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="ts-translator.html#635"><span data-toggle="tooltip" data-title="reg.Region[]">regions</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; reg.Region">pop</span><span class="punctuation">(</span><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#8391"><span data-toggle="tooltip" data-title="reg.Region">region</span></a><span class="punctuation">.</span><a href="../region.html#2702"><span data-toggle="tooltip" data-title="reg.Visibility">visibility</span></a> <span class="punctuation">==</span> <a href="ts-translator.html#465"><span data-toggle="tooltip" data-title="typeof reg">reg</span></a><span class="punctuation">.</span><a href="../region.html#1434"><span class="typename" data-toggle="tooltip" data-title="typeof reg.Visibility">Visibility</span></a><span class="punctuation">.</span><a href="../region.html#1954"><span data-toggle="tooltip" data-title="reg.Visibility.Visible">Visible</span></a><span class="punctuation">)</span>
            <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#5199"><span class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; void">openCodeBlock</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
        <span class="keyword">else</span> <span class="punctuation">{</span>
            <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#5199"><span class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; void">openCodeBlock</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="ts-translator.html#8391"><span data-toggle="tooltip" data-title="reg.Region">region</span></a><span class="punctuation">.</span><a href="../region.html#2702"><span data-toggle="tooltip" data-title="reg.Visibility.Hidden | reg.Visibility.Collapsed">visibility</span></a> <span class="punctuation">==</span> <a href="ts-translator.html#465"><span data-toggle="tooltip" data-title="typeof reg">reg</span></a><span class="punctuation">.</span><a href="../region.html#1434"><span class="typename" data-toggle="tooltip" data-title="typeof reg.Visibility">Visibility</span></a><span class="punctuation">.</span><a href="../region.html#1971"><span data-toggle="tooltip" data-title="reg.Visibility.Collapsed">Collapsed</span></a><span class="punctuation">)</span>
                <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#6736"><span class="member" data-toggle="tooltip" data-title="(text: string) =&gt; void">appendMarkdown</span></a><span class="punctuation">(</span><span class="string">&quot;\n&lt;/details&gt;\n&quot;</span><span class="punctuation">)</span>
            <span class="keyword">else</span>
                <span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#6736"><span class="member" data-toggle="tooltip" data-title="(text: string) =&gt; void">appendMarkdown</span></a><span class="punctuation">(</span><span class="string">&#039;\n--&gt;\n&#039;</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
        <a href="ts-translator.html#8391"><span data-toggle="tooltip" data-title="reg.Region">region</span></a><span class="punctuation">.</span><a href="../region.html#3856"><span class="member" data-toggle="tooltip" data-title="(end: bl.BlockList) =&gt; void">close</span></a><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">.</span><a href="base-translator.html#1646"><span data-toggle="tooltip" data-title="bl.BlockList">currBlock</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>

        </div>
            <div class="sidepane narrow-scrollbars">
                
        <div class="pagemenu">
            <h3>On This Page</h3>
                <ul class="pagetree">
                </ul>
        </div>
            </div>
        </div>
        
        <div class="footer">
            <a class="footer-button" href="md-translator.html">
            <p>Previous</p>
            <p>¬´ Markdown Translator</p>
        </a>
            <div class="footer-text">
                <p>Copyright ¬© 2023 Tommi Johtela</p>
                <p>Generated by 
                    <a href="https://johtela.github.io/litscript">LiTScript</a>
                </p>
            </div>
            <a class="footer-button" href="ts-html-translator.html">
            <p>Next</p>
            <p>TypeScript Translator for HTML Output ¬ª</p>
        </a>
        </div>
    
        <script src="../../dist/normal.js"></script>

    <script>
      function reloadLink(path) {
        for (const link of document.getElementsByTagName("link")) {
          const url = new URL(link.href)
          if (url.host == location.host && url.pathname == path) {
            const next = link.cloneNode()
            next.href = path + '?' + Math.random().toString(36).slice(2)
            next.onload = () => link.remove()
            link.parentNode.insertBefore(next, link.nextSibling)
            return
          }
        }
      }
      function scriptLoaded(path) {
        for (const script of document.getElementsByTagName("script"))
          if (script.src) {
            const url = new URL(script.src)
            if (url.host == location.host && url.pathname == path)
              return true
          }
        return false
      }
      let ls = new EventSource('/litscript')
      ls.onmessage = e => {
        let updated = JSON.parse(e.data)
        for (let i = 0; i < updated.length; ++i) {
          let path = updated[i]
          if (path.endsWith(".js")) {
            if (scriptLoaded(path))
              return location.reload()
          }
          else if (path.endsWith(".html")) {
            if (path == location.pathname)
              return location.reload()
          }
          else reloadLink(path)
        }
      }
      window.addEventListener("beforeunload", () => ls.close())
    </script>
    </body>
    </html>